!function(){var e=angular.module("confab",["ngAnimate","ui.bootstrap","ui.tree","ui.router","ui.codemirror","ngCookies","angularLocalStorage"]);e.config(["$stateProvider","$urlRouterProvider",function(e,t){console.log("Application config..."),e.state("app",{url:"/",views:{content:{templateUrl:"views/home.html",controller:"IndexController as vm"}}}).state("app.moderator",{url:"moderator",views:{"content@":{templateUrl:"views/moderator.html",controller:"ModeratorController as vm3"}}}),t.otherwise("/")}])}(),function(){"use strict";angular.module("confab").controller("IndexController",["$scope","$interval","$timeout","$uibModal","xmlTag","attributeObject","StaticDataFactory","StorageFactory","EditorFactory","ValidationFactory","IafFactory","ZipService","ModeratorFactory",function(e,t,o,n,r,l,i,s,a,c,u,d,g){function f(e){switch(e){case"tabauth":G.showeditor=!1,G.showauth=!0;break;case"tabedit":G.showeditor=!0,G.showauth=!1}var t=document.getElementById(e);t.classList.toggle("active1");var o=_.without(G.thetabs,e);o.forEach(function(e){var t=document.getElementById(e);t.classList.remove("active1")}),console.log("toggling tab",G.showeditor,G.showauth)}function m(){return 0!==i.getTimerId()?void console.log("cancelling a timer..."):(console.log("starting timer"),G.timerId=t(function(){G.showSpinnerSmall=!0,o(function(){G.showSpinnerSmall=!1},1e3);var e=s.getGetter(s.getCurrentKey().title)();console.log("saving : ",p(s.getCurrentKey().title)," with id ",G.timerId),s.getSetter(e)(K.getValue())},5e3),void i.setTimerId(G.timerId))}function p(e){if(void 0===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);return t.length>0?t:e}function h(){G.showSpinner=!G.showSpinner}function v(){h();var e=s.getGetter(s.getCurrentKey().title)();console.log("saving : ",p(s.getCurrentKey().title)),s.getSetter(e)(K.getValue()),d.sendZip().then(function(e){h();var t=document.getElementById("sendstatus");t.style.background="green",o(function(){t.style.background="none"},5e3),console.log("successful response",e)},function(e){var t=document.getElementById("sendstatus");t.style.background="red",h(),o(function(){t.style.background="none"},5e3),console.log("error from zipservice sending zip",e)})}function y(){console.log("credentials:",G.iaf_url),u.setCredentials(G.iaf_url,G.username,G.password).then(function(e){console.log("setting credentials and updating the scope"),G.navigatorModel=JSON.parse(e.data.JSONMONSTER.MYMONSTER),E("pipes")},function(e){})}function S(){var e=n.open({templateUrl:"./views/modalcredentials.html",controller:"LoadCredentialsController as vm4",size:"md",resolve:{items:function(){return"something"}}});e.result.then(function(e){console.log("response: ",e),G.iaf_url=e.iaf_url,G.username=e.username,G.password=e.password,y()},function(e){console.log("no result from modal...")})}function w(){h(),c.validateXml(G.currentKey.title).then(function(e){G.validationMessage=e,h(),console.log("validating....",G.validationMessage)},function(e){h()})}function b(){var e=document.getElementsByClassName("CodeMirror")[0];e.style.fontSize=G.selectedFontSize.toString()+"px"}function I(e){j=a.editorLoaded(e),K=j.getDoc(),null===s.getGetter("IAF_URL")()||void 0===s.getGetter("IAF_URL")()?S():i.getJson().then(function(e){G.navigatorModel=JSON.parse(e.data.JSONMONSTER.MYMONSTER),console.log("returned datamodel : \n",G.navigatorModel),j.setOption("hintOptions",{schemaInfo:G.navigatorModel}),j.foldCode(CodeMirror.Pos(0,0)),j.foldCode(CodeMirror.Pos(K.lineCount(),0)),E("pipes"),N(),F(),F(),A(),m()},function(e){console.log("error initialising:",e.data)})}function M(e){console.log("toggling lock",e.title,e.isLocked),O(e.isLocked)}function O(e){j.setOption("readOnly",e)}function C(e){O(!1)}function $(){j.setOption("theme",G.selectedTheme)}function T(e,t){console.log("modify ",e,t),s.getSetter(e)(t)}function k(){G.showSpinnerSmall=!0,o(function(){G.showSpinnerSmall=!1},1e3),console.log("getting next document:");var t=s.switchKey();console.log("returned key",t),e.$broadcast("KeySwitch",t),A(t)}function P(){var e=s.getCurrentKey().title,t=K.getValue(),o=s.getGetter(e)();console.log("storing data",e,o,t),s.getSetter(o)(t)}function A(e){if(void 0===e&&(e=s.getCurrentKey()),console.log("alias",e),void 0===s.getGetter(e.title)())o(function(){console.log("waiting for StorageFactory to settle...",Date.now());var t=s.getGetter(e.title)();K.setValue(s.getGetter(t)())},50);else{var t=s.getGetter(e.title)();K.setValue(s.getGetter(t)())}0===i.getTimerId()&&m()}function F(){var e=document.getElementById("navigatorcontainer");G.showConfig?e.style.left="0%":e.style.left="-25%",G.showConfig=!G.showConfig}function N(){var e=document.getElementById("editorcontainer"),t=document.getElementById("navItem"),o=document.getElementById("picture"),n=document.getElementById("iplogo");o&&t&&e&&(G.showNavigator?(e.style.width="75%",e.style.left="25%",n.style.top="10px",t.style.left="89%",o.classList.add("fa-toggle-left"),o.classList.remove("fa-toggle-right")):(e.style.width="100%",e.style.left="0%",t.style.left="0%",n.style.top="10px",o.classList.remove("fa-toggle-left"),o.classList.add("fa-toggle-right")),G.showNavigator=!G.showNavigator)}function L(e){G.selectedItem=e,i.setSelectedItem(e),G.selectedProperties={};for(var t=0;t<e.properties.length;t++)if("classname"==e.properties[t][0]||"className"==e.properties[t][0]){var o=document.getElementById("checkbox"+t);if(null===o)break;o.click();break}}function E(e){i.setDataSource(e),G.datasource=i.getDataSource(),G.showPropertyDescription=!1;var t=!1,o="zzz";Object.keys(G.navigatorModel).forEach(function(n){t||G.navigatorModel[n].type!==e||n<o&&(o=n)}),L(G.navigatorModel[o])}function D(){j.getOption("readOnly")!==!0&&(K.setValue("<?xml version='1.0' encoding='UTF-8'?>\n"),K.setCursor({line:K.lastLine(),ch:0}),j.focus())}function x(){function e(e,t,o){var n=Math.abs(o.line-t.line),r=Math.abs(o.line-e.line);if(n>r)return!1;if(r>n)return!0;var l=Math.abs(o.ch-t.ch),i=Math.abs(o.ch-e.ch);return!(l>i)}var t=K.getCursor(),o=K.getRange({line:t.line,ch:0},t),n=o.match(/<[\w\/\s=\'\"]+$|<[\w\/\s=\'\"]+>[\w\s]*$/);null!==n&&(o=n[0]);var r=K.getRange(t,{line:t.line,ch:null}),l=r.match(/^[\w\/\s=\'\"]+>|^<[\w\/\s=\'\"]+>/);null!==l&&(r=l[0]);for(var s=j.getSearchCursor(o),a=0,c={line:1e4,ch:1e4},u=-1;s.find()===!0;){var d=s.to();e(t,d,c)&&(c=d,u=a),a++}var g=i.getFormattingSettings();K.setValue(html_beautify(K.getValue(),g)),s=j.getSearchCursor(o);for(var f=0;f<u+1;f++)s.find();s.to()&&K.setCursor(s.to()),j.focus()}function V(e){return("classname"===e[0]||"className"===e[0])&&(G.selectedProperties[e[0]]=new l("className",new Array(e[2])),!0)}function R(){if(null!==G.selectedItem&&j.getOption("readOnly")!==!0)if("snippets"===G.selectedItem.type)console.log("selectedItem:",G.selectedItem),K.replaceSelection(G.selectedItem.xml);else{var e=[];console.log("props:",G.selectedProperties),Object.keys(G.selectedProperties).length>0&&Object.keys(G.selectedProperties).forEach(function(t){e.push(G.selectedProperties[t])});var t=new r(G.selectedItem.classname,e);K.replaceSelection(t.toCompleteTag()),j.focus()}}console.log("IndexController...");var G=this;G.submitForm=R,G.codemirrorLoaded=I,G.setSelectedClass=L,G.toggle_datasource=E,G.styleEditorContent=x,G.clearEditor=D,G.showNav=N,G.showConf=F,G.storeData=P,G.retrieveData=A,G.toggleSlot=k,G.modifyAlias=T,G.checkDefaults=V,G.changeTheme=$,G.changeFontSize=b,G.validateXml=w,G.sendZip=v,G.toggleSpinner=h,G.setCredentials=y,G.toggleReadonly=M,G.unlock=C,G.message="Angular Controller is working allright...",G.userInput="",G.datasource=i.getDataSource(),G.navigatorModel=null,G.selectedItem=null,G.showPropertyDescription=!1,G.selectedProperties={},G.showConfig=!1,G.showNavigator=!0,G.showFullEditor=!1;var j=null,K=null;G.timerId=null,G.showValidationMessage=!1,G.validationMessage=null,G.currentKey=s.getCurrentKey(),G.iaf_url=s.getGetter("IAF_URL")();s.initialise();G.themes=i.getThemes(),G.selectedTheme="twilight",G.selectedFontSize=14,G.fontSizes=i.getFontSizes(),G.availableLessons=[],G.toggleTab=f,G.thetabs=["tabauth","tabedit"],f("tabauth"),e.$on("$destroy",function(){console.log("cancelling timer...",typeof G.timerId),t.cancel()}),e.$on("Keychange",function(){G.currentKey=s.getCurrentKey(),console.log("keychange",G.currentKey.title),A(G.currentKey),M(G.currentKey)}),e.$on("saveOldValues",function(){G.showSpinnerSmall=!0,o(function(){G.showSpinnerSmall=!1},1e3);var e=s.getGetter(s.getCurrentKey().title)();console.log("saving : ",p(s.getCurrentKey().title)),s.getSetter(e)(K.getValue())})}]).controller("LoadCredentialsController",["$uibModalInstance","items",function(e,t){function o(){console.log("returning with credentials..."),e.close({iaf_url:r.iaf_url,username:r.username,password:r.password})}function n(){e.dismiss()}console.log("loading credentials...");var r=this;r.iaf_url=null,r.username=null,r.password=null,r.submitCredentials=o,r.closeModal=n}]).filter("datasourceFilter",["StaticDataFactory",function(e){return function(t){var o=[];return angular.forEach(t,function(t){t.type===e.getDataSource()&&o.push(t)}),o.sort(function(e,t){var o=e.classname.toLowerCase(),n=t.classname.toLowerCase();return o<n?-1:o>n?1:0}),o}}]).filter("cleanupFilter",function(){return function(e){if(void 0!==e){var t=e.replace(/&lt;/g,"<"),o=t.replace(/&gt;/g,">");return o}}})}(),function(){"use strict";angular.module("confab").directive("nameGiver",["StorageFactory",function(e){return{restrict:"A",link:function(t,o,n){o.bind("blur",function(o){function n(o){for(var a=0;a<o.length;a++){if(console.log(o[a].title,o[a].id),o[a].id==l){var c=angular.element(i).scope();console.log("siblings: ",c.$parentNodesScope.$modelValue);for(var u=c.$parentNodesScope.$modelValue,d=0;d<u.length;d++)if(u[d].title==s)return i.innerHTML=r(c.$modelValue.title),void alert("please no double names in this directory!");if(o[a].title=s,console.log("match",o[a],s,t.vm2.mySlots),!o[a].isDirectory){var g=e.getGetter(t.vm2.mySlots[l].title)(),f=t.vm2.mySlots[l].title;e.changeKeys(f,s),e.getSetter(f)(),e.getSetter(s)(g),t.vm2.mySlots[l].title=s;var m=e.getGetter("myslots")();m[l].title=s,e.getSetter("myslots")(m)}i.setAttribute("contentEditable",!1),t.$apply(),e.getSetter("thejson")(t.vm2.list);break}o[a].nodes.length>0&&n(o[a].nodes)}}function r(e){if(void 0===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);return t.length>0?t:e}var l=o.target.id.match(/\d+/g)[0];console.log("digit",l,o.target.id);var i=document.getElementById("treeitem"+l),s=i.innerHTML,a=t.vm2.list;console.log("text",s,a,l),n(a)}),o.bind(["keydown"],function(e){var t=e.which||e.keyCode||eventt.charCode;if(console.log("code",t),13===t){e.preventDefault();var o=document.getElementById("treeitem"+e.target.id.match(/\d+/g));o.blur()}})}}}]).directive("propertyListener",["attributeObject",function(e){return{link:function(t,o,n){o.bind("click",function(o){var n=document.getElementById("propertyheader"),r=document.getElementById("propertytext");console.log("clicked property",o.target.id,n.innerHTML);var l=o.target.id.match(/\d+$/)[0],i=t.vm.selectedItem.properties[l];n.innerHTML=i[0],r.innerHTML=i[1];var s=document.getElementById("checkbox"+l),a=document.getElementById("propertyvalue"+l),c=t.vm.selectedItem;if(console.log("items:",s,a,c),"object"==typeof s)switch(s.checked){case!0:console.log("adding ..."),t.vm.selectedProperties[i[0]]=new e(i[0],new Array(a.value));break;case!1:console.log("deleting ..."),delete t.vm.selectedProperties[i[0]]}console.info("selected properties",t.vm.selectedProperties)})}}}]).directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){function r(){n.$setViewValue(t.html())}n.$render=function(){t.html(n.$viewValue||"")},t.bind("keyup change",function(t){console.log("changing property......");var o=t.target.id;if("newproperty"!==o&&"newclassname"!==o&&"newdescription"!==o){var n=e.vm3.selectedItem.properties[e.vm3.selectedProperty][0];e.$apply(r);var l=e.vm3.selectedItem.properties[e.vm3.selectedProperty][0],i=e.vm3.selectedItem.attrs;l!==n&&(Object.defineProperty(i,l,Object.getOwnPropertyDescriptor(i,n)),delete i[n])}else"newclassname"!==o&&e.$apply(r)}),t.bind("blur",function(t){console.log("changing classname......");var o=t.target.id;if("newclassname"===o){var n=e.vm3.selectedItem.classname;e.$apply(r);var l=e.vm3.selectedItem.classname;delete e.vm3.dataModel[n],e.vm3.dataModel[l]=e.vm3.selectedItem}else e.$apply(r)})}}})}(),function(){"use strict";var e=angular.module("confab");e.controller("ModeratorController",["$scope","StaticDataFactory","$uibModal","StorageFactory","ModeratorFactory",function(e,t,o,n,r){function l(){r.postJsonBulk(h.selectedItem.description)}function i(){console.log("selected",h.selectedItem.classname),t.loadXml(h.selectedItem.classname).then(function(e){h.selectedItem.xml=e.data})}function s(){h.newProperty=null,h.addingProperty=!1,h.addingItem=!0,h.dataModel.NEWITEM={classname:"NEWITEM",description:"enter your description here",type:"general",xml:"",attrs:{},properties:[]},h.selectedItem=h.dataModel.NEWITEM}function a(){h.currentSlotNumber=n.switchKey().title,console.log("toggle slot",h.currentSlotNumber);var e=n.getGetter(h.currentSlotNumber)();h.selectedItem.xml=n.getGetter(e)()}function c(e){h.selectedItem.attrs[h.selectedItem.properties[e][0]]=new Array(h.selectedItem.properties[e][2])}function u(e){switch(e){case"add":h.newProperty={propname:"new_property",propdes:"replace with your description",propdef:""};break;case"cancel":h.newProperty=null;break;case"confirm":if(""===h.newProperty.propname||""===h.newProperty.propdes)return;h.selectedItem.attrs[h.newProperty.propname]=new Array(h.newProperty.propdef),h.selectedItem.properties.unshift(new Array(h.newProperty.propname,h.newProperty.propdes,h.newProperty.propdef)),h.newProperty=null}}function d(){h.showSpinner=!h.showSpinner}function g(e){console.log("deleting property",e,h.selectedItem.properties[e][0]),delete h.selectedItem.attrs[h.selectedItem.properties[e][0]],h.selectedItem.properties.splice(e,1)}function f(){o.open({templateUrl:"./views/itemcontents.html",controller:"ModalController as vm5",windowClass:"mymodal",resolve:{items:function(){return h.selectedItem}}})}function m(){console.log(h.selectedItem),d(),r.postDatamonster(h.dataModel).then(function(e){d(),console.log("success",e)},function(e){d(),console.log("fail",e)})}function p(){o.open({templateUrl:"./views/modal_delete_item.html",animation:!0,controller:"Modal2Controller as vm6",size:"sm",backdrop:"static",resolve:{item:function(){return h.selectedItem}}}).result.then(function(e){console.log("result:",e),"delete"===e&&(d(),r.deleteItem(h.selectedItem.classname).then(function(e){d(),console.log("response from service: ",e);var t=h.selectedItem.classname;delete h.dataModel[t],h.selectedItem=h.dataModel[Object.keys(h.dataModel)[0]],m()},function(e){d(),console.log(e)}))})}var h=this;h.showModel=f,h.deleteProperty=g,h.changeAttr=c,h.addProperty=u,h.addNewClass=s,h.otherSlot=a,h.postDatamonster=m,h.checkForXml=i,h.postJsonBulk=l,h.confirmDelete=p,console.log("moderatorcontroller attached..."),t.stopTimer(),h.dataModel=JSON.parse(t.getStaticJson()),console.log(h.dataModel),h.currentSlotNumber=n.getCurrentKey().title,h.showPropertyDescription=!1,h.selectedProperty=0,h.addingProperty=!1,h.newProperty=null,h.addingItem=!1,null===h.dataModel?(console.log("resolving data from iaf data:"),t.getJson().then(function(e){h.dataModel=JSON.parse(e.data.JSONMONSTER.MYMONSTER),h.selectedItem=h.dataModel[Object.keys(h.dataModel)[0]],console.log("selected itemm",h.selectedItem)},function(e){console.log("error")})):(h.selectedItem=t.getSelectedItem(),console.log("data2",h.selectedItem))}]).controller("ModalController",["$uibModalInstance","items",function(e,t){function o(){e.close()}var n=this;n.closeModal=o,n.items=JSON.stringify(t,null,4)}]).controller("Modal2Controller",["$uibModalInstance","item",function(e,t){function o(){e.close("cancel")}function n(){e.close("delete")}var r=this;r.closeModal=o,r.deleteItem=n,r.item=t}])}(),function(){"use strict";var e=angular.module("confab");e.factory("ModeratorFactory",["$http","StorageFactory",function(e,t){function o(e){u=e,console.log("availableLesson",u)}function n(){return u}function r(t){try{e.post(API_URL+"/postJsonBulk",t).then(function(e){console.log("success",e)},function(e){console.log("failure",e)})}catch(o){alert("improper json\n",o)}}function l(){}function i(t,o){return console.log("posting a monster with length ",Object.keys(t).length),e({method:"POST",url:c+"/api/storejson",data:t,headers:{"content-type":"application/json"}}).then(function(e){console.log("saving result",e.status),s(o)},function(e){console.log("failed result posting datamonster",e.status)})}function s(t){return e.post(c+"/api/postiaftag",t).then(function(e){console.log("saving a tag",e.status)},function(e){console.log("failed result posting tag",e.status)})}function a(t){return e({method:"GET",url:c+"/api/deleteiaftag/"+t}).then(function(e){return e},function(e){return e})}var c=t.getGetter("IAF_URL")(),u=null;return{postJsonBulk:r,postDatamonster:i,postSchema:l,deleteItem:a,setAvailableLesson:o,getAvailableLessons:n}}])}(),function(){"use strict";var e=angular.module("confab");e.constant("PROJECTNAME","Ibis4Student"),e.constant("API_URL","http://localhost:3000"),e.constant("DOWNLOAD_URL","/iaf/api/configurations/download/Ibis4Student"),e.constant("UPLOAD_URL","/iaf/api/configurations"),e.factory("StaticDataFactory",["xmlTag","$http","StorageFactory","$interval",function(e,t,o,n){function r(){M=o.getGetter("IAF_URL")()}function l(e){I=e}function i(){return I}function s(e){y=e}function a(e){return y}function c(){console.log("stopping timer..."),n.cancel(y),y=0}function u(){return S}function d(){return w}function g(){return O}function f(e){v=e}function m(){return v}function p(){return t.get(M+"/api/getjson").then(function(e){return console.info("returning json from server with status ",e.status),b=e.data.JSONMONSTER.MYMONSTER,e},function(e){console.log("server error :",e)})}function h(){return b}var v="pipes",y=0,S=["twilight","monokai","neat"],w=[12,13,14,15,16,17,18,19,20],b=null,I=null,M=o.getGetter("IAF_URL")(),O={indent_size:4,xml:{end_with_newline:!0,js:{indent_size:2},css:{indent_size:2}},css:{indent_size:1},js:{"preserve-newlines":!0}};return{getJson:p,getStaticJson:h,setDataSource:f,getDataSource:m,getFormattingSettings:g,getThemes:u,getFontSizes:d,setTimerId:s,getTimerId:a,stopTimer:c,setSelectedItem:l,getSelectedItem:i,setIafUrl:r}}]),e.factory("ZipService",["StorageFactory","$http","DOWNLOAD_URL","UPLOAD_URL","PROJECTNAME",function(e,t,o,n,r){function l(){m=e.getGetter("IAF_URL")()}function i(){return e.getGetter("thejson")()}function s(){return e.getGetter("myslots")()}function a(){return f}function c(t){return new Promise(function(o,n){function r(e){if(void 0===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);return t.length>0?t:e}var l=new JSZip,i=document.querySelectorAll("[ui-tree-node]");i.forEach(function(t){for(var o=angular.element(t).scope(),n=[];null!==o.$parentNodeScope;)n.push(o.$parentNodeScope.$modelValue.title),o=o.$parentNodeScope;for(var i="";n.length>0;)i+=r(n.pop())+"/";if("Configuration.xml"===r(angular.element(t).scope().$modelValue.title)?i="Ibis4Student/Configuration.xml":i+=r(angular.element(t).scope().$modelValue.title),angular.element(t).scope().$modelValue.isDirectory)l.folder(i);else{var s=e.getGetter(angular.element(t).scope().$modelValue.title)();l.file(i,e.getGetter(s)())}});var s=Date.now(),a="configuration.version="+s;l.file("BuildInfo_SC.properties",a),console.log("Zipfile ",l),t?(console.log("saving as a zip file..."),l.generateAsync({type:"blob"}).then(function(e){var t=new Blob([e],{type:"application/zip"});console.log("generated a zip...",t),saveAs(t,"configuration.zip"),o()})):u(l,s).then(function(e){console.log("returning from postconfig"),o(e)},function(e){console.log("returning error from postconfig"),n(e)})})}function u(e,o){return new Promise(function(r,l){if(void 0===m||"string"!=typeof m)return alert("please add a correct IAF url"),"error";var i=m+n;alert(i),e.generateAsync({type:"blob"}).then(function(e){var n="configuration.zip",s=new FormData;s.append("realm","jdbc"),s.append("name","Ibis4Student"),s.append("version",o),s.append("encoding","utf-8"),s.append("multiple_configs",!1),s.append("activate_config",!0),s.append("automatic_reload",!0),s.append("file",e,n),console.log("posting to iaf",e),t({method:"POST",url:i,data:s,headers:{"Content-type":void 0}}).then(function(e){console.info("returning from backend",e),r(e)},function(e){console.info("returning error from backend",e),l(e)})})})}function d(t){return JSZip.loadAsync(t).then(function(t){function o(t){t>l.length-1||(l[t].dir?(t++,o(t)):l[t].async("string").then(function(n){var r="slot"+Math.ceil(1e3*Math.random());e.getSetter(l[t].name)(r),e.getSetter(r)(n),t++,o(t++)}))}function n(e,t){if(e===t)return!1;var o=t.lastIndexOf("/");return t.substring(0,o)===e}console.log("loadasync from file...",t),e.deleteAll();var l=[];t.forEach(function(e,t){"__"!==t.name.substring(0,2)&&t.name!==r+"/"&&"BuildInfo_SC.properties"!==t.name&&l.push(t)});for(var i=0;i<l.length;i++)if(l[i].name.indexOf(r)>-1){console.log("slicing out",l[i].name);var s=l[i].name,a=s.substring(s.lastIndexOf("/")+1,s.length);l[i].name=a}o(0),console.log("zipfiles",l);var c=[];f={};for(var i=0;i<l.length;i++)if(l[i].dir)c.push({id:Math.ceil(1e4*Math.random()),isDirectory:l[i].dir,title:l[i].name.substring(0,l[i].name.length-1),nodes:[]});else{var u={id:Math.ceil(1e4*Math.random()),isDirectory:l[i].dir,title:l[i].name,nodes:[]};c.push(u),f[u.id]={title:u.title,isLocked:!1}}c.sort(function(e,t){return e.title.split("/").length>t.title.split("/").length?-1:e.title.split("/").length<t.title.split("/").length?1:0});for(var a=0,d=!0;d&&a<100;){d=!1;for(var g=c,m=0;m<c.length;m++){for(var p=0;p<g.length;p++)if(n(c[m].title,g[p].title)){c[m].nodes.push(g[p]),c.splice(p,1),d=!0;break}if(d)break}a++}return console.log("generated json out of zip:\n",c),e.getSetter("thejson")(c),e.getSetter("myslots")(f),c})}function g(){var n=m+o;return console.log("Download url :",n),t({method:"GET",url:n,responseType:"arraybuffer"}).then(function(t){return new Promise(function(o,n){JSZip.loadAsync(t.data).then(function(t){function n(t){t>i.length-1||(i[t].dir?(t++,n(t)):i[t].async("string").then(function(o){var r="slot"+Math.ceil(1e3*Math.random());e.getSetter(i[t].name)(r),e.getSetter(r)(o),t++,n(t++)}))}function l(e,t){if(e===t)return!1;var o=t.lastIndexOf("/");return t.substring(0,o)===e}console.log("loadasync...",t),e.deleteAll();var i=[];t.forEach(function(e,t){"__"!==t.name.substring(0,2)&&t.name!==r+"/"&&"BuildInfo_SC.properties"!==t.name&&i.push(t)});for(var s=0;s<i.length;s++)if(i[s].name.indexOf(r)>-1){console.log("slicing out",i[s].name);var a=i[s].name,c=a.substring(a.lastIndexOf("/")+1,a.length);i[s].name=c}n(0),console.log("zipfiles",i);var u=[];f={};for(var s=0;s<i.length;s++)if(i[s].dir)u.push({id:Math.ceil(1e4*Math.random()),isDirectory:i[s].dir,title:i[s].name.substring(0,i[s].name.length-1),nodes:[]});else{var d={id:Math.ceil(1e4*Math.random()),isDirectory:i[s].dir,title:i[s].name,nodes:[]};u.push(d),f[d.id]={title:d.title,isLocked:!1}}u.sort(function(e,t){return e.title.split("/").length>t.title.split("/").length?-1:e.title.split("/").length<t.title.split("/").length?1:0});for(var c=0,g=!0;g&&c<100;){g=!1;for(var m=u,p=0;p<u.length;p++){for(var h=0;h<m.length;h++)if(l(u[p].title,m[h].title)){u[p].nodes.push(m[h]),u.splice(h,1),g=!0;break}if(g)break}c++}console.log("generated json out of zip:\n",u),e.setCurrentKey(f[0]),e.getSetter("thejson")(u),e.getSetter("myslots")(f),o(u)},function(e){console.log("error",e),n(e)})})},function(e){console.log("error in http call",e)},function(e){console.log("error in http call",e)})}var f,m=e.getGetter("IAF_URL")();return{init:i,getSlots:s,getZip:g,getZipFromFile:d,sendZip:c,getMySlots:a,setIafUrl:l}}]),e.factory("StorageFactory",["storage","$log",function(e,t){function o(e,t){console.log(e,t,"\n",v,w,"\n");for(var o=-1,n="",r=0;r<v.length;r++)v[r].title===e&&(o=r,n=v[r].isLocked);o!==-1&&(w.title===e&&(w.title=t),v[o].title=t),console.log("after change: ",v,"\n",w,"\n")}function n(){var t=e.getKeys();t.forEach(function(e){"IAF_URL"!==e&&d(e)()})}function r(){var e=v.shift();return v.push(e),w=v[0],v[0]}function l(e,t){console.log("id ",t);var o="slot"+Math.ceil(1e3*Math.random()),n={title:e,isLocked:!1};v.push(n),d(o)('<?xml version="1.0" encoding="UTF-8"?>'),d(e)(o);var r=g("myslots")();return r[t]=n,d("myslots")(r),o}function i(){if(e.getKeys().indexOf("ngIdle.expiry")>-1&&d("ngIdle.expiry")(),0===e.getKeys().length||null!==g("IAF_URL")()){console.log("adding files..."),d("slot1")(" start here..."),d("file1")("slot1");var t=[{id:1,title:"dir1",isDirectory:!0,nodes:[{id:2,title:"file1",isDirectory:!1,isLocked:!1,nodes:[]}]}],o={2:{title:"file1",isLocked:!1}};d("thejson")(t),d("myslots")(o),v=u(["file1"])}else{console.log("adding from what was in local storage.");var n=e.getKeys();n.indexOf("ngIdle.expiry")>-1&&n.splice(n.indexOf("ngIdle.expiry"),1),n.indexOf("thejson")>-1&&n.splice(n.indexOf("thejson"),1),n.indexOf("myslots")>-1&&n.splice(n.indexOf("myslots"),1),n.indexOf("IAF_URL")>-1&&n.splice(n.indexOf("IAF_URL"),1),v=u(n)}w=v[0]}function s(){var e=[];return S.forEach(function(t){e.push(g(t)())}),e}function a(e){console.log("set currentkey::",e),w=e}function c(){return w}function u(e){var t=[];return e.forEach(function(e){"slot"!==e.substring(0,4)&&t.push({title:e,isLocked:!1})}),t}function d(e){return f(e),y[e].setter}function g(e){return f(e),y[e].getter}function f(e){if(!e||angular.isUndefined(e))throw new Error("Key[ "+e+" ] is invalid");y.hasOwnProperty(e)||m(e)}function m(e){var t=p(e),o=h(e);y[e]={setter:t,getter:o}}function p(o){return function(n){if(angular.isDefined(n))try{e.set(o,n)}catch(r){t.info("[StorageFactory]"+r.message)}else e.remove(o)}}function h(t){return function(){var o=e.get(t);if(null===o){o=void 0;var n=y[t].setter;n(o)}return o}}var v,y={},S=["file1"],w="slot1";return{getSetter:d,getGetter:g,verifyKey:f,createAPIForKey:m,createSetter:p,createGetter:h,getAliases:s,switchKey:r,setCurrentKey:a,getCurrentKey:c,getNewSlotname:l,initialise:i,deleteAll:n,changeKeys:o}}]),e.factory("EditorFactory",function(){function e(e){function t(e,t){e.getCursor();return t&&!t()||setTimeout(function(){e.state.completionActive||e.showHint({completeSingle:!1})},100),CodeMirror.Pass}function o(e){return t(e,function(){var t=e.getCursor();return"<"==e.getRange(CodeMirror.Pos(t.line,t.ch-1),t)})}function n(e){return t(e,function(){var t=e.getTokenAt(e.getCursor());if("string"==t.type&&(!/['"]/.test(t.string.charAt(t.string.length-1))||1==t.string.length))return!1;var o=CodeMirror.innerMode(e.getMode(),t.state).state;return o.tagName})}e.getDoc();e.focus(),e.setOption("lineNumbers",!0),e.setOption("lineWrapping",!0),e.setOption("mode","xml"),e.setOption("beautify","true"),e.setOption("theme","twilight"),e.setOption("foldGutter",!0),e.setOption("gutters",["CodeMirror-linenumbers","CodeMirror-foldgutter"]),e.setOption("matchTags",{bothTags:!0});var r={"'<'":t,"'/'":o,"' '":n,"'='":n,"Ctrl-Space":"autocomplete"};e.setOption("extraKeys",r),console.log("editor loaded;",e.options);var l=window.innerHeight,i=document.getElementById("mynavbar").offsetHeight,s=document.querySelector(".CodeMirror");return s.style.height=l-i+"px",console.log("window, navbar, editor:",l,i,s.style.height),e}return{editorLoaded:e}}),e.factory("ValidationFactory",["StorageFactory","$http",function(e,t){function o(){}return{validateXml:o}}]),e.factory("IafFactory",["$http","StorageFactory","StaticDataFactory","ZipService","UPLOAD_URL",function(e,t,o,n,r){function l(t){return new Promise(function(o,n){var l=s+r;alert(l),t.generateAsync({type:"blob"}).then(function(t){var o="configuration.zip",n=new FormData;return n.append("realm","jdbc"),n.append("name","Ibis4Student"),n.append("version",1),n.append("encoding","utf-8"),n.append("multiple_configs",!1),n.append("activate_config",!0),n.append("automatic_reload",!0),n.append("file",t,o),new Promise(function(o,r){return console.log("posting to iaf",t),e({method:"POST",url:l,data:n,headers:{"Content-type":void 0}}).then(function(e){console.info("returning from backend",e),o(e)},function(e){console.info("returning error from backend",e),r(e)})})}),o()})}function i(e,r,l){return console.log("server",e,r,l),new Promise(function(r,l){e?(console.log("iaf url",e),s=e,t.getSetter("IAF_URL")(e),o.setIafUrl(),n.setIafUrl(),null!==o.getStaticJson()&&void 0!==o.getStaticJson()||o.getJson().then(function(e){console.log("succes from factory... now updating the scope"),r(e)},function(e){console.log("failure getting json...",e),l(e)})):console.log("doing noting...")})}var s=t.getGetter("IAF_URL")();return{postConfig:l,setCredentials:i}}])}(),function(){"use strict";angular.module("confab").controller("ApsTreeController",["$scope","$uibModal","ZipService","StorageFactory","StaticDataFactory","IafFactory","$timeout",function(e,t,o,n,r,l,i){function s(){var e=t.open({templateUrl:"./views/loadzipdialog.html",controller:"LoadZipController as vm3",size:"md",resolve:{items:function(){return"something"}}});e.rendered.then(function(t){var l=document.getElementById("zipfromfile");console.log(l),l.addEventListener("change",function(t){console.log("file chosen !",t.target.files[0]),e.close({returntype:"viafile"}),r.stopTimer(),o.getZipFromFile(t.target.files[0]).then(function(e){console.log("succes..."),S.list=e,console.log(S.list),S.mySlots=o.getMySlots();var t=Object.keys(S.mySlots);n.setCurrentKey(S.mySlots[t[0]]),f({id:t[0]})},function(e){console.log("failure...",e)})})},function(e){}),e.result.then(function(e){if(console.log("response: ",e.returntype),"viahttp"===e.returntype){S.list=e.data,S.mySlots=o.getMySlots();var t=Object.keys(S.mySlots);f({id:t[0]}),console.log(S.list)}},function(e){console.log("no result from modal...")})}function a(){o.sendZip(!0).then(function(e){alert("savedToFile!")},function(e){console.log("saving to file failed...")})}function c(e){var t="file"!==e,o={id:Math.floor(1e4*Math.random()),title:e+y(),isDirectory:t,isLocked:!1,nodes:[]};S.list.push(o),"file"===e&&(n.getNewSlotname(o.title,o.id),S.mySlots[o.id]={title:o.title,isLocked:!1},f(o))}function u(){S.list=n.getGetter("thejson")(),S.mySlots=n.getGetter("myslots")()}function d(){console.log("getzip..."),o.getZip().then(function(e){console.log("data back",e),S.list=e,S.mySlots=o.getMySlots();var t=Object.keys(S.mySlots);f({id:t[0]}),console.log(S.list)},function(e){console.log("failure getting zip: ",e)})}function g(e,t){console.log("modify ",e,t),n.getSetter(e)(t)}function f(t){console.log("changing selected slot...",t),t.hasOwnProperty("id")?(e.$emit("saveOldValues"),S.selectedSlot=t.id,n.setCurrentKey(S.mySlots[S.selectedSlot]),e.$emit("Keychange")):t.isDirectory||(e.$emit("saveOldValues"),S.selectedSlot=t.$modelValue.id,n.setCurrentKey(S.mySlots[S.selectedSlot]),e.$emit("Keychange")),console.log("setting slot to ",S.selectedSlot)}function m(e){var t=document.getElementById("treeitem"+e.$modelValue.id);t.setAttribute("contentEditable",!0);var o=t.firstChild,n=o.length,r=document.createRange();r.setStart(o,0),r.setEnd(o,n);var l=window.getSelection();l.removeAllRanges(),l.addRange(r),console.log("element: ",t),t.focus()}function p(e){function t(e){var t=S.mySlots[e].title,o=n.getGetter(t)();console.log("removing slots:",o," alias ",t),n.getSetter(t)(),n.getSetter(o)();var r=n.getGetter("myslots")();delete r[e],n.getSetter("myslots")(r)}function o(e){function t(e){for(var n=0;n<e.length;n++)e[n].isDirectory?e[n].nodes.length>0&&t(e[n].nodes):o.push(e[n].id)}var o=[];console.log("children:",e.$childNodesScope.$modelValue);var n=e.$childNodesScope.$modelValue;return t(n),o}function r(e){for(var t=e;null!==t.$parentNodeScope;)t=t.$parentNodeScope;return console.log("root:",t.$parentNodesScope.$modelValue),
t}function l(t,o){if(o)return o;for(var n=0;n<t.length;n++){if(console.log(t[n].title,t[n].id),!t[n].isDirectory&&t[n]!==e.$modelValue){console.log("match with",t[n].title),o=!0;break}t[n].nodes.length>0&&(o=l(t[n].nodes,o))}return o}function i(e,t){for(var o=0;o<e.length;o++)if(e[o].isDirectory&&e[o].id!==t)return console.log("found directory",e[o].title),!0}var s=(e.$modelValue.id,r(e)),a=e.$modelValue.isDirectory,c=0;if(a)for(var u=e;null!==u&&c<10;){if(i(u.$parentNodesScope.$modelValue,e.$modelValue.id)){console.log("removable: ",e.$modelValue.title);var d=o(e);console.log("results: ",d),d.length<Object.keys(S.mySlots).length&&(d.forEach(function(e){t(e),delete S.mySlots[e]}),e.remove());break}u=u.$parentNodeScope,console.log("watching layer above",u),c++}else l(s.$parentNodesScope.$modelValue,!1)&&(console.log("removable: ",e.$modelValue.title),t(e.$modelValue.id),delete S.mySlots[e.$modelValue.id],e.remove())}function h(e){e.toggle()}function v(e){var t=e.$modelValue;if(console.log(t),t.isDirectory)t.nodes.push({id:Math.floor(1e4*Math.random()),title:t.title,isDirectory:!0,nodes:[]});else{var o=Math.floor(1e4*Math.random()),r=t.title+"-"+y(),l={id:o,title:r,isDirectory:!1,isLocked:!1,nodes:[]};null!==e.$parentNodeScope?e.$parentNodeScope.$modelValue.nodes.push(l):S.list.push(l),n.getNewSlotname(r,o),S.mySlots[o]={title:r,isLocked:!1},f(l)}}function y(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHILJKLMNOPRSTUVWXYZ",t="",o=0;o<3;o++){var n=Math.floor(Math.random()*e.length),r=e.substring(n,n+1);t+=r}return t}console.log("TreeController...");var S=this;S.remove=p,S.toggle=h,S.setSelectedSlot=f,S.changeName=m,S.newSubitem=v,S.modifyAlias=g,S.getZip=d,S.addFileOrFolder=c,S.saveToFile=a,S.showZipDialog=s,S.treeOptions={},u(),e.$on("KeySwitch",function(e,t){var o=Object.keys(S.mySlots);console.log("treecontro",t,o);for(var n=0;n<o.length;n++)if(S.mySlots[o[n]].title==t.title){console.log("bingo",o[n]);var r={id:o[n],title:o[n].title,isLocked:o,nodes:[],isDirectory:!1};f(r)}}),e.$watch("vm2.selectedSlot",function(){console.log("selected slot changed: ",S.selectedSlot)}),e.$watch("vm2.list",function(){console.log("updating local storage;"),n.getSetter("thejson")(S.list)},!0)}]).controller("LoadZipController",["$uibModalInstance","ZipService","items",function(e,t,o){function n(){console.log("getzip over http..."),t.getZip().then(function(t){console.log("data back",t),e.close({returntype:"viahttp",data:t})},function(e){console.log("failure getting zip via http: ",e)})}function r(){e.close("dialog cancelled.")}var l=this;l.closeModal=r,l.getZipOverHttp=n}]).filter("cropFilter",function(){return function(e){if(void 0===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);return t.length>0?t:e}})}(),function(){angular.module("confab").factory("xmlTag",function(){function e(e,t){this.tagType="STARTTAG",this.elementName=e,tagProperties={},t.forEach(function(e){tagProperties[e.getAttributeName()]=e.getAttributeValues()}),this.tagProperties=tagProperties}var t=["FixedQuerySender","XmlWellFormedChecker","XmlValidator","XmlSwitch","XmlIf","WsdlXmlValidator","RemoveFromSession","PutSystemDateInSession","PutInSession","MailSender","LogSender","Json2XmlValidator","JmsCommunicator","PutParametersInSession","IsolatedServiceExecutor","IsolatedServiceCaller","IfMultipart","GetFromSession","FixedResultSender","FixedResult","FilenameSwitch","XmlParamSwitch","EchoSender"];return e.prototype={getTagType:function(){return this.tagType},setTagType:function(e){switch(e){case"STARTTAG":this.tagType="STARTTAG";break;case"COMBITAG":this.tagType="COMBITAG";break;case"ENDTAG":this.tagType="ENDTAG";break;default:console.log("tagType is set to default..",e," is unknown type."),this.tagType="STARTTAG"}},toCompleteTag:function(){var e="",t="";return this.convertToPipe(),angular.forEach(this.tagProperties,function(e,o){t+=""==e?" "+o+'=""  ':" "+o+'="'+e+'"'}),e="<"+this.elementName+t+"></"+this.elementName+">"},toObject:function(){var e={};return e[this.elementName]=this.tagProperties,console.log("myobj",e),e},setProperty:function(e,t){this.tagProperties[e]=t},getPropertyValue:function(e){return this.tagProperties[e]},convertToPipe:function(){this.elementName.search(/^.*Pipe$/)!==-1&&(this.elementName="pipe"),t.includes(this.elementName)&&(this.elementName="pipe");var e="/^.*Pipe$/";console.log("elementname",this.elementName,this.elementName.search(e))}},e}).factory("attributeObject",function(){function e(e,t,o){this.name=e,void 0!==t?this.values=t:this.values=[],void 0!==o?this.hasDefault=o:this.hasDefault=!1}return e.prototype={setAttributeValue:function(e){this.hasDefault?this.values.unShift(e):this.values.push(e)},insertValues:function(e){this.values=e},getAttributeName:function(){return this.name},getAttributeValues:function(){return this.values},setDefaultValue:function(e){this.hasDefault=e},toString:function(){return this.name+"Allowed values:"+this.values.join()}},e})}();
//# sourceMappingURL=scripts.min.js.map
