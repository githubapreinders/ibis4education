!function(){var e=angular.module("confab",["ngAnimate","ui.bootstrap","ui.tree","ui.router","ui.codemirror","ngCookies","angularLocalStorage"]);e.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("app",{url:"/",views:{content:{templateUrl:"views/home.html",controller:"IndexController as vm"}}}).state("app.moderator",{url:"moderator",views:{"content@":{templateUrl:"views/moderator.html",controller:"ModeratorController as vm"}}}).state("app.courseinfo",{url:"courseinfo",views:{"content@":{templateUrl:"views/courseinfo.html",controller:"CourseInfoController as vm"}}}),t.otherwise("/")}])}(),function(){"use strict";angular.module("confab").controller("IndexController",["$scope","$interval","$timeout","xmlTag","attributeObject","StaticDataFactory","StorageFactory","EditorFactory","ValidationFactory","IafFactory","ZipService","ModeratorFactory",function(e,t,n,r,o,i,a,l,s,c,u,d){function f(e){switch(e){case"tabauth":V.showeditor=!1,V.showauth=!0;break;case"tabedit":V.showeditor=!0,V.showauth=!1}var t=document.getElementById(e);t.classList.toggle("active1");var n=_.without(V.thetabs,e);n.forEach(function(e){var t=document.getElementById(e);t.classList.remove("active1")})}function m(e){d.setAvailableLesson(e)}function g(){V.timerId=t(function(){V.showSpinnerSmall=!0,n(function(){V.showSpinnerSmall=!1},1e3);var e=a.getGetter(a.getCurrentKey().title)();a.getSetter(e)(G.getValue())},5e3),i.setTimerId(V.timerId)}function p(){V.showSpinner=!V.showSpinner}function h(){p(),u.sendZip().then(function(e){p();var t=document.getElementById("sendstatus");t.style.background="green",n(function(){t.style.background="none"},5e3)},function(e){var t=document.getElementById("sendstatus");t.style.background="red",p(),n(function(){t.style.background="none"},5e3)})}function v(){c.setCredentials(V.iaf_url,V.username,V.password)}function y(){p(),s.validateXml(V.currentKey.title).then(function(e){V.validationMessage=e,p()},function(e){p()})}function S(){var e=document.getElementsByClassName("CodeMirror")[0];e.style.fontSize=V.selectedFontSize.toString()+"px"}function b(e){R=l.editorLoaded(e),G=R.getDoc(),i.getJson().then(function(e){V.navigatorModel=JSON.parse(e.data.JSONMONSTER.MYMONSTER),Object.keys(V.navigatorModel).forEach(function(e,t){"lesson"===V.navigatorModel[e].type&&V.availableLessons.push(V.navigatorModel[e]),V.availableLessons.length>0&&m(V.availableLessons[0].url)}),R.setOption("hintOptions",{schemaInfo:V.navigatorModel}),R.foldCode(CodeMirror.Pos(0,0)),R.foldCode(CodeMirror.Pos(G.lineCount(),0)),F("pipes"),$(),L(),L();a.initialise();A(),g(),c.setIAFURL()},function(e){})}function w(e){I(e.isLocked)}function I(e){R.setOption("readOnly",e)}function M(e){I(!1)}function C(){R.setOption("theme",V.selectedTheme)}function O(e,t){a.getSetter(e)(t)}function P(){V.showSpinnerSmall=!0,n(function(){V.showSpinnerSmall=!1},1e3);var t=a.switchKey();e.$broadcast("KeySwitch",t),A(t)}function T(){var e=a.getCurrentKey().title,t=G.getValue(),n=a.getGetter(e)();a.getSetter(n)(t)}function A(e){if(void 0===e&&(e=a.getCurrentKey()),void 0===a.getGetter(e.title)())n(function(){var t=a.getGetter(e.title)();G.setValue(a.getGetter(t)())},50);else{var t=a.getGetter(e.title)();G.setValue(a.getGetter(t)())}0===i.getTimerId()&&g()}function L(){var e=document.getElementById("navigatorcontainer");V.showConfig?e.style.left="0%":e.style.left="-25%",V.showConfig=!V.showConfig}function $(){var e=document.getElementById("editorcontainer"),t=document.getElementById("navItem"),n=document.getElementById("picture"),r=document.getElementById("iplogo");n&&t&&e&&(V.showNavigator?(e.style.width="75%",e.style.left="25%",r.style.top="10px",t.style.left="89%",n.classList.add("fa-toggle-left"),n.classList.remove("fa-toggle-right")):(e.style.width="100%",e.style.left="0%",t.style.left="0%",r.style.top="10px",n.classList.remove("fa-toggle-left"),n.classList.add("fa-toggle-right")),V.showNavigator=!V.showNavigator)}function k(e){V.selectedItem=e,i.setSelectedItem(e),V.selectedProperties={};for(var t=0;t<e.properties.length;t++)if("classname"==e.properties[t][0]||"className"==e.properties[t][0]){var n=document.getElementById("checkbox"+t);if(null===n)break;n.click();break}}function F(e){i.setDataSource(e),V.datasource=i.getDataSource(),V.showPropertyDescription=!1;var t=!1,n="zzz";Object.keys(V.navigatorModel).forEach(function(r){t||V.navigatorModel[r].type!==e||r<n&&(n=r)}),k(V.navigatorModel[n])}function E(){R.getOption("readOnly")!==!0&&(G.setValue("<?xml version='1.0' encoding='UTF-8'?>\n"),G.setCursor({line:G.lastLine(),ch:0}),R.focus())}function D(){function e(e,t,n){var r=Math.abs(n.line-t.line),o=Math.abs(n.line-e.line);if(r>o)return!1;if(o>r)return!0;var i=Math.abs(n.ch-t.ch),a=Math.abs(n.ch-e.ch);return!(i>a)}var t=G.getCursor(),n=G.getRange({line:t.line,ch:0},t),r=n.match(/<[\w\/\s=\'\"]+$|<[\w\/\s=\'\"]+>[\w\s]*$/);null!==r&&(n=r[0]);var o=G.getRange(t,{line:t.line,ch:null}),a=o.match(/^[\w\/\s=\'\"]+>|^<[\w\/\s=\'\"]+>/);null!==a&&(o=a[0]);for(var l=R.getSearchCursor(n),s=0,c={line:1e4,ch:1e4},u=-1;l.find()===!0;){var d=l.to();e(t,d,c)&&(c=d,u=s),s++}var f=i.getFormattingSettings();G.setValue(html_beautify(G.getValue(),f)),l=R.getSearchCursor(n);for(var m=0;m<u+1;m++)l.find();l.to()&&G.setCursor(l.to()),R.focus()}function N(e){return("classname"===e[0]||"className"===e[0])&&(V.selectedProperties[e[0]]=new o("className",new Array(e[2])),!0)}function x(){if(null!==V.selectedItem&&R.getOption("readOnly")!==!0)if("snippets"===V.selectedItem.type)G.replaceSelection(V.selectedItem.xml);else{var e=[];Object.keys(V.selectedProperties).length>0&&Object.keys(V.selectedProperties).forEach(function(t){e.push(V.selectedProperties[t])});var t=new r(V.selectedItem.classname,e);G.replaceSelection(t.toCompleteTag()),R.focus()}}var V=this;V.submitForm=x,V.codemirrorLoaded=b,V.setSelectedClass=k,V.toggle_datasource=F,V.styleEditorContent=D,V.clearEditor=E,V.showNav=$,V.showConf=L,V.storeData=T,V.retrieveData=A,V.toggleSlot=P,V.modifyAlias=O,V.checkDefaults=N,V.changeTheme=C,V.changeFontSize=S,V.validateXml=y,V.sendZip=h,V.toggleSpinner=p,V.setCredentials=v,V.setAvailableLesson=m,V.toggleReadonly=w,V.unlock=M,V.message="Angular Controller is working allright...",V.userInput="",V.datasource=i.getDataSource(),V.navigatorModel=null,V.selectedItem=null,V.showPropertyDescription=!1,V.selectedProperties={},V.showConfig=!1,V.showNavigator=!0,V.showFullEditor=!1;var R=null,G=null;V.timerId=null,V.showValidationMessage=!1,V.validationMessage=null,V.currentKey=a.getCurrentKey(),V.iaf_url=a.getGetter("IAF_URL")(),V.themes=i.getThemes(),V.selectedTheme="twilight",V.selectedFontSize=14,V.fontSizes=i.getFontSizes(),V.availableLessons=[],V.toggleTab=f,V.thetabs=["tabauth","tabedit"],f("tabauth"),e.$on("Keychange",function(){V.currentKey=a.getCurrentKey(),A(V.currentKey),w(V.currentKey)}),e.$on("saveOldValues",function(){V.showSpinnerSmall=!0,n(function(){V.showSpinnerSmall=!1},1e3);var e=a.getGetter(a.getCurrentKey().title)();a.getSetter(e)(G.getValue())})}]).filter("datasourceFilter",["StaticDataFactory",function(e){return function(t){var n=[];return angular.forEach(t,function(t){t.type===e.getDataSource()&&n.push(t)}),n.sort(function(e,t){var n=e.classname.toLowerCase(),r=t.classname.toLowerCase();return n<r?-1:n>r?1:0}),n}}]).filter("cleanupFilter",function(){return function(e){if(void 0!==e){var t=e.replace(/&lt;/g,"<"),n=t.replace(/&gt;/g,">");return n}}})}(),function(){"use strict";angular.module("confab").directive("nameGiver",["StorageFactory",function(e){return{restrict:"A",link:function(t,n,r){n.bind("blur",function(n){function r(n){for(var s=0;s<n.length;s++){if(n[s].id==i){for(var c=angular.element(a).scope(),u=c.$parentNodesScope.$modelValue,d=0;d<u.length;d++)if(u[d].title==l)return void(a.innerHTML=o(c.$modelValue.title));if(n[s].title=l,!n[s].isDirectory){var f=e.getGetter(t.vm2.mySlots[i].title)(),m=t.vm2.mySlots[i].title;e.changeKeys(m,l),e.getSetter(m)(),e.getSetter(l)(f),t.vm2.mySlots[i].title=l;var g=e.getGetter("myslots")();g[i].title=l,e.getSetter("myslots")(g)}a.setAttribute("contentEditable",!1),t.$apply(),e.getSetter("thejson")(t.vm2.list);break}n[s].nodes.length>0&&r(n[s].nodes)}}function o(e){if(void 0===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);return t.length>0?t:e}var i=n.target.id.match(/\d+/g)[0],a=document.getElementById("treeitem"+i),l=a.innerHTML,s=t.vm2.list;r(s)}),n.bind(["keydown"],function(e){var t=e.which||e.keyCode||eventt.charCode;if(13===t){e.preventDefault();var n=document.getElementById("treeitem"+e.target.id.match(/\d+/g));n.blur()}})}}}]).directive("propertyListener",["attributeObject",function(e){return{link:function(t,n,r){n.bind("click",function(n){var r=document.getElementById("propertyheader"),o=document.getElementById("propertytext"),i=n.target.id.match(/\d+$/)[0],a=t.vm.selectedItem.properties[i];r.innerHTML=a[0],o.innerHTML=a[1];var l=document.getElementById("checkbox"+i),s=document.getElementById("propertyvalue"+i);t.vm.selectedItem;if("object"==typeof l)switch(l.checked){case!0:t.vm.selectedProperties[a[0]]=new e(a[0],new Array(s.value));break;case!1:delete t.vm.selectedProperties[a[0]]}})}}}]).directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){function o(){r.$setViewValue(t.html())}r.$render=function(){t.html(r.$viewValue||"")},t.bind("blur keyup change",function(t){var n=t.target.id;if("newproperty"!==n&&"newclassname"!==n&&"newdescription"!==n){var r=e.vm.selectedItem.properties[e.vm.selectedProperty][0];e.$apply(o);var i=e.vm.selectedItem.properties[e.vm.selectedProperty][0],a=e.vm.selectedItem.attrs;i!==r&&(Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(a,r)),delete a[r])}else e.$apply(o)})}}})}(),function(){"use strict";var e=angular.module("confab");e.controller("ModeratorController",["$scope","StaticDataFactory","$uibModal","StorageFactory","ModeratorFactory",function(e,t,n,r,o){function i(){o.postJsonBulk(h.selectedItem.description)}function a(){t.loadXml(h.selectedItem.classname).then(function(e){h.selectedItem.xml=e.data})}function l(){f(),o.postTag(h.selectedItem).then(function(e){f()},function(e){f()})}function s(){h.newProperty=null,h.addingProperty=!1,h.addingItem=!0,h.dataModel.NEWITEM={classname:"NEWITEM",description:"enter your description here",type:"general",xml:"",attrs:{},properties:[]},h.selectedItem=h.dataModel.NEWITEM}function c(){h.currentSlotNumber=r.switchKey().title;var e=r.getGetter(h.currentSlotNumber)();h.selectedItem.xml=r.getGetter(e)()}function u(e){h.selectedItem.attrs[h.selectedItem.properties[e][0]]=new Array(h.selectedItem.properties[e][2])}function d(e){switch(e){case"add":h.newProperty={propname:"new_property",propdes:"replace with your description",propdef:""};break;case"cancel":h.newProperty=null;break;case"confirm":if(""===h.newProperty.propname||""===h.newProperty.propdes)return;h.selectedItem.attrs[h.newProperty.propname]=new Array(h.newProperty.propdef),h.selectedItem.properties.unshift(new Array(h.newProperty.propname,h.newProperty.propdes,h.newProperty.propdef)),h.newProperty=null}}function f(){h.showSpinner=!h.showSpinner}function m(e){delete h.selectedItem.attrs[h.selectedItem.properties[e][0]],h.selectedItem.properties.splice(e,1)}function g(){h.displayItem=JSON.stringify(h.selectedItem,["properties"],4);n.open({templateUrl:"./views/mymodal.html",controller:"ModalController as vm",windowClass:"mymodal",resolve:{items:function(){return h.selectedItem}}})}function p(){n.open({templateUrl:"./views/modal_delete_item.html",animation:!0,controller:"Modal2Controller as vm",size:"sm",backdrop:"static",resolve:{item:function(){return h.selectedItem}}}).result.then(function(e){"delete"===e&&(f(),o.deleteItem(h.selectedItem.classname).then(function(e){f();var t=h.selectedItem.classname;delete h.dataModel[t],h.selectedItem=h.dataModel[Object.keys(h.dataModel)[0]]},function(e){f()}))})}var h=this;h.showModel=g,h.deleteProperty=m,h.changeAttr=u,h.addProperty=d,h.addNewClass=s,h.otherSlot=c,h.postTag=l,h.checkForXml=a,h.postJsonBulk=i,h.confirmDelete=p,t.stopTimer(),e.$on("$viewContentLoaded",function(){}),h.dataModel=t.getStaticJson(),h.currentSlotNumber=r.getCurrentKey().title,h.showPropertyDescription=!1,h.selectedProperty=0,h.addingProperty=!1,h.newProperty=null,h.addingItem=!1,null===h.dataModel?t.getJson().then(function(e){h.dataModel=e.data,h.selectedItem=h.dataModel[Object.keys(h.dataModel)[0]]}):h.selectedItem=t.getSelectedItem()}]).controller("ModalController",["$uibModalInstance","items",function(e,t){function n(){e.close()}var r=this;r.closeModal=n,r.items=JSON.stringify(t,null,4)}]).controller("Modal2Controller",["$uibModalInstance","item",function(e,t){function n(){e.close("cancel")}function r(){e.close("delete")}var o=this;o.closeModal=n,o.deleteItem=r,o.item=t}]).controller("CourseInfoController",["StaticDataFactory","ModeratorFactory",function(e,t){var n=this;e.stopTimer(),n.currentLesson=t.getAvailableLessons(),document.getElementById("Example2").src=n.currentLesson}])}(),function(){"use strict";var e=angular.module("confab");e.factory("ModeratorFactory",["$http","StorageFactory","API_URL",function(e,t,n){function r(e){c=e}function o(){return c}function i(t){try{e.post(n+"/postJsonBulk",t).then(function(e){},function(e){})}catch(r){}}function a(t){return e.post(n+"/postIaftag",t).then(function(e){},function(e){})}function l(){}function s(t){return e({method:"GET",url:n+"/deleteItem?resource="+t}).then(function(e){return e},function(e){return e})}var c=null;return{postJsonBulk:i,postTag:a,postSchema:l,deleteItem:s,setAvailableLesson:r,getAvailableLessons:o}}])}(),function(){"use strict";var e=angular.module("confab");e.constant("PROJECTNAME","Ibis4Student"),e.constant("API_URL","http://localhost:3000"),e.constant("DOWNLOAD_URL","http://ibis4education-env.bz46fawhzf.eu-central-1.elasticbeanstalk.com/iaf/api/configurations/download/Ibis4Student"),e.constant("UPLOAD_URL","http://ibis4education-env.bz46fawhzf.eu-central-1.elasticbeanstalk.com/iaf/api/configurations"),e.constant("IAF_URL","http://ibis4education-env.bz46fawhzf.eu-central-1.elasticbeanstalk.com"),e.factory("StaticDataFactory",["xmlTag","$http","StorageFactory","API_URL","IAF_URL","$interval",function(e,t,n,r,o,i){function a(e){C=e}function l(){return C}function s(e){b=e}function c(e){return b}function u(){i.cancel(b),b=0}function d(){return w}function f(){return I}function m(){return O}function g(e){S=e}function p(){return S}function h(){return t.get(o+"/api/getjson").then(function(e){return M=e.data.JSONMONSTER.MYMONSTER,e},function(e){})}function v(){return M}function y(e){return t.get(r+"/snippets?resource="+e).then(function(e){return e},function(e){})}var S="pipes",b=0,w=["twilight","monokai","neat"],I=[12,13,14,15,16,17,18,19,20],M=null,C=null,O={indent_size:4,xml:{end_with_newline:!0,js:{indent_size:2},css:{indent_size:2}},css:{indent_size:1},js:{"preserve-newlines":!0}};return{getJson:h,getStaticJson:v,loadXml:y,setDataSource:g,getDataSource:p,getFormattingSettings:m,getThemes:d,getFontSizes:f,setTimerId:s,getTimerId:c,stopTimer:u,setSelectedItem:a,getSelectedItem:l}}]),e.factory("ZipService",["StorageFactory","$http","DOWNLOAD_URL","UPLOAD_URL","PROJECTNAME",function(e,t,n,r,o){function i(){return e.getGetter("thejson")()}function a(){return e.getGetter("myslots")()}function l(){return f}function s(t){return new Promise(function(n,r){function o(e){if(void 0===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);return t.length>0?t:e}var i=new JSZip,a=document.querySelectorAll("[ui-tree-node]");a.forEach(function(t){for(var n=angular.element(t).scope(),r=[];null!==n.$parentNodeScope;)r.push(n.$parentNodeScope.$modelValue.title),n=n.$parentNodeScope;for(var a="";r.length>0;)a+=o(r.pop())+"/";if("Configuration.xml"===o(angular.element(t).scope().$modelValue.title)?a="Ibis4Student/Configuration.xml":a+=o(angular.element(t).scope().$modelValue.title),angular.element(t).scope().$modelValue.isDirectory)i.folder(a);else{var l=e.getGetter(angular.element(t).scope().$modelValue.title)();i.file(a,e.getGetter(l)())}});var l=Date.now(),s="configuration.version="+l;i.file("BuildInfo_SC.properties",s),t?i.generateAsync({type:"blob"}).then(function(e){var t=new Blob([e],{type:"application/zip"});saveAs(t,"configuration.zip"),n()}):c(i,l).then(function(e){n(e)},function(e){r(e)})})}function c(e,n){return new Promise(function(o,i){if(void 0===r||"string"!=typeof r)return"error";var a=r;e.generateAsync({type:"blob"}).then(function(e){var r="configuration.zip",l=new FormData;l.append("realm","jdbc"),l.append("name","Ibis4Student"),l.append("version",n),l.append("encoding","utf-8"),l.append("multiple_configs",!1),l.append("activate_config",!0),l.append("automatic_reload",!0),l.append("file",e,r),t({method:"POST",url:a,data:l,headers:{"Content-type":void 0}}).then(function(e){o(e)},function(e){i(e)})})})}function u(t){return JSZip.loadAsync(t).then(function(t){function n(t){t>i.length-1||(i[t].dir?(t++,n(t)):i[t].async("string").then(function(r){var o="slot"+Math.ceil(1e3*Math.random());e.getSetter(i[t].name)(o),e.getSetter(o)(r),t++,n(t++)}))}function r(e,t){if(e===t)return!1;var n=t.lastIndexOf("/");return t.substring(0,n)===e}e.deleteAll();var i=[];t.forEach(function(e,t){"__"!==t.name.substring(0,2)&&t.name!==o+"/"&&"BuildInfo_SC.properties"!==t.name&&i.push(t)});for(var a=0;a<i.length;a++)if(i[a].name.indexOf(o)>-1){var l=i[a].name,s=l.substring(l.lastIndexOf("/")+1,l.length);i[a].name=s}n(0);var c=[];f={};for(var a=0;a<i.length;a++)if(i[a].dir)c.push({id:Math.ceil(1e4*Math.random()),isDirectory:i[a].dir,title:i[a].name.substring(0,i[a].name.length-1),nodes:[]});else{var u={id:Math.ceil(1e4*Math.random()),isDirectory:i[a].dir,title:i[a].name,nodes:[]};c.push(u),f[u.id]={title:u.title,isLocked:!1}}c.sort(function(e,t){return e.title.split("/").length>t.title.split("/").length?-1:e.title.split("/").length<t.title.split("/").length?1:0});for(var s=0,d=!0;d&&s<100;){d=!1;for(var m=c,g=0;g<c.length;g++){for(var p=0;p<m.length;p++)if(r(c[g].title,m[p].title)){c[g].nodes.push(m[p]),c.splice(p,1),d=!0;break}if(d)break}s++}return e.getSetter("thejson")(c),e.getSetter("myslots")(f),c})}function d(){return t({method:"GET",url:n,responseType:"arraybuffer"}).then(function(t){return new Promise(function(n,r){JSZip.loadAsync(t.data).then(function(t){function r(t){t>a.length-1||(a[t].dir?(t++,r(t)):a[t].async("string").then(function(n){var o="slot"+Math.ceil(1e3*Math.random());e.getSetter(a[t].name)(o),e.getSetter(o)(n),t++,r(t++)}))}function i(e,t){if(e===t)return!1;var n=t.lastIndexOf("/");return t.substring(0,n)===e}e.deleteAll();var a=[];t.forEach(function(e,t){"__"!==t.name.substring(0,2)&&t.name!==o+"/"&&"BuildInfo_SC.properties"!==t.name&&a.push(t)});for(var l=0;l<a.length;l++)if(a[l].name.indexOf(o)>-1){var s=a[l].name,c=s.substring(s.lastIndexOf("/")+1,s.length);a[l].name=c}r(0);var u=[];f={};for(var l=0;l<a.length;l++)if(a[l].dir)u.push({id:Math.ceil(1e4*Math.random()),isDirectory:a[l].dir,title:a[l].name.substring(0,a[l].name.length-1),nodes:[]});else{var d={id:Math.ceil(1e4*Math.random()),isDirectory:a[l].dir,title:a[l].name,nodes:[]};u.push(d),f[d.id]={title:d.title,isLocked:!1}}u.sort(function(e,t){return e.title.split("/").length>t.title.split("/").length?-1:e.title.split("/").length<t.title.split("/").length?1:0});for(var c=0,m=!0;m&&c<100;){m=!1;for(var g=u,p=0;p<u.length;p++){for(var h=0;h<g.length;h++)if(i(u[p].title,g[h].title)){u[p].nodes.push(g[h]),u.splice(h,1),m=!0;break}if(m)break}c++}e.setCurrentKey(f[0]),e.getSetter("thejson")(u),e.getSetter("myslots")(f),n(u)},function(e){r(e)})})},function(e){},function(e){})}var f;return{init:i,getSlots:a,getZip:d,getZipFromFile:u,sendZip:s,getMySlots:l}}]),e.factory("StorageFactory",["storage","$log",function(e,t){function n(e,t){for(var n=-1,r="",o=0;o<v.length;o++)v[o].title===e&&(n=o,r=v[o].isLocked);n!==-1&&(b.title===e&&(b.title=t),v[n].title=t)}function r(){var t=e.getKeys();t.forEach(function(e){"IAF_URL"!==e&&d(e)()})}function o(){var e=v.shift();return v.push(e),b=v[0],v[0]}function i(e,t){var n="slot"+Math.ceil(1e3*Math.random()),r={title:e,isLocked:!1};v.push(r),d(n)('<?xml version="1.0" encoding="UTF-8"?>'),d(e)(n);var o=f("myslots")();return o[t]=r,d("myslots")(o),n}function a(){if(0===e.getKeys().length){d("slot1")(" start here..."),d("file1")("slot1");var t=[{id:1,title:"dir1",isDirectory:!0,nodes:[{id:2,title:"file1",isDirectory:!1,isLocked:!1,nodes:[]}]}],n={2:{title:"file1",isLocked:!1}};d("thejson")(t),d("myslots")(n),v=u(["file1"])}else{var r=e.getKeys();r.indexOf("ngIdle.expiry")>-1&&r.splice(r.indexOf("ngIdle.expiry"),1),r.indexOf("thejson")>-1&&r.splice(r.indexOf("thejson"),1),r.indexOf("myslots")>-1&&r.splice(r.indexOf("myslots"),1),r.indexOf("IAF_URL")>-1&&r.splice(r.indexOf("IAF_URL"),1),v=u(r)}b=v[0]}function l(){var e=[];return S.forEach(function(t){e.push(f(t)())}),e}function s(e){b=e}function c(){return b}function u(e){var t=[];return e.forEach(function(e){"slot"!==e.substring(0,4)&&t.push({title:e,isLocked:!1})}),t}function d(e){return m(e),y[e].setter}function f(e){return m(e),y[e].getter}function m(e){if(!e||angular.isUndefined(e))throw new Error("Key[ "+e+" ] is invalid");y.hasOwnProperty(e)||g(e)}function g(e){var t=p(e),n=h(e);y[e]={setter:t,getter:n}}function p(n){return function(r){if(angular.isDefined(r))try{e.set(n,r)}catch(o){t.info("[StorageFactory]"+o.message)}else e.remove(n)}}function h(t){return function(){var n=e.get(t);if(null===n){n=void 0;var r=y[t].setter;r(n)}return n}}var v,y={},S=["file1"],b="slot1";return{getSetter:d,getGetter:f,verifyKey:m,createAPIForKey:g,createSetter:p,createGetter:h,getAliases:l,switchKey:o,setCurrentKey:s,getCurrentKey:c,getNewSlotname:i,initialise:a,deleteAll:r,changeKeys:n}}]),e.factory("EditorFactory",function(){function e(e){function t(e,t){e.getCursor();return t&&!t()||setTimeout(function(){e.state.completionActive||e.showHint({completeSingle:!1})},100),CodeMirror.Pass}function n(e){return t(e,function(){var t=e.getCursor();return"<"==e.getRange(CodeMirror.Pos(t.line,t.ch-1),t)})}function r(e){return t(e,function(){var t=e.getTokenAt(e.getCursor());if("string"==t.type&&(!/['"]/.test(t.string.charAt(t.string.length-1))||1==t.string.length))return!1;var n=CodeMirror.innerMode(e.getMode(),t.state).state;return n.tagName})}e.getDoc();e.focus(),e.setOption("lineNumbers",!0),e.setOption("lineWrapping",!0),e.setOption("mode","xml"),e.setOption("beautify","true"),e.setOption("theme","twilight"),e.setOption("foldGutter",!0),e.setOption("gutters",["CodeMirror-linenumbers","CodeMirror-foldgutter"]),e.setOption("matchTags",{bothTags:!0});var o={"'<'":t,"'/'":n,"' '":r,"'='":r,"Ctrl-Space":"autocomplete"};e.setOption("extraKeys",o);var i=window.innerHeight,a=document.getElementById("mynavbar").offsetHeight,l=document.querySelector(".CodeMirror");return l.style.height=i-a+"px",e}return{editorLoaded:e}}),e.factory("ValidationFactory",["StorageFactory","$http","API_URL",function(e,t,n){function r(){return t.get(n+"/validate").then(function(t){var n=e.getGetter(e.getCurrentKey())(),r=validateXML(n,t.data);return r},function(e){return e})}return{validateXml:r}}]),e.factory("IafFactory",["$http","StorageFactory","UPLOAD_URL",function(e,t,n){function r(){n=t.getGetter("UPLOAD_URL")()}function o(t){return new Promise(function(r,o){var i=n;t.generateAsync({type:"blob"}).then(function(t){var n="configuration.zip",r=new FormData;return r.append("realm","jdbc"),r.append("name","Ibis4Student"),r.append("version",1),r.append("encoding","utf-8"),r.append("multiple_configs",!1),r.append("activate_config",!0),r.append("automatic_reload",!0),r.append("file",t,n),new Promise(function(t,n){return e({method:"POST",url:i,data:r,headers:{"Content-type":void 0}}).then(function(e){t(e)},function(e){n(e)})})}),r()})}function i(e,r,o){return e&&(n=e,t.getSetter("UPLOAD_URL")(e)),r=r,o=o,{apiurl:e,uname:r,pw:o}}return{postConfig:o,setCredentials:i,setIAFURL:r}}])}(),function(){"use strict";angular.module("confab").controller("ApsTreeController",["$scope","$uibModal","ZipService","StorageFactory","StaticDataFactory","IafFactory","$timeout",function(e,t,n,r,o,i,a){function l(){var e=t.open({templateUrl:"./views/loadzipdialog.html",controller:"LoadZipController as vm3",size:"md",resolve:{items:function(){return"something"}}});e.rendered.then(function(t){var i=document.getElementById("zipfromfile");i.addEventListener("change",function(t){e.close({returntype:"viafile"}),o.stopTimer(),n.getZipFromFile(t.target.files[0]).then(function(e){S.list=e,S.mySlots=n.getMySlots();var t=Object.keys(S.mySlots);r.setCurrentKey(S.mySlots[t[0]]),m({id:t[0]})},function(e){})})},function(e){}),e.result.then(function(e){if("viahttp"===e.returntype){S.list=e.data,S.mySlots=n.getMySlots();var t=Object.keys(S.mySlots);m({id:t[0]})}},function(e){})}function s(){n.sendZip(!0).then(function(e){},function(e){})}function c(e){var t="file"!==e,n={id:Math.floor(1e4*Math.random()),title:e+y(),isDirectory:t,isLocked:!1,nodes:[]};S.list.push(n),"file"===e&&(r.getNewSlotname(n.title,n.id),S.mySlots[n.id]={title:n.title,isLocked:!1},m(n))}function u(){S.list=r.getGetter("thejson")(),S.mySlots=r.getGetter("myslots")()}function d(){n.getZip().then(function(e){S.list=e,S.mySlots=n.getMySlots();var t=Object.keys(S.mySlots);m({id:t[0]})},function(e){})}function f(e,t){r.getSetter(e)(t)}function m(t){t.hasOwnProperty("id")?(e.$emit("saveOldValues"),S.selectedSlot=t.id,r.setCurrentKey(S.mySlots[S.selectedSlot]),e.$emit("Keychange")):t.isDirectory||(e.$emit("saveOldValues"),S.selectedSlot=t.$modelValue.id,r.setCurrentKey(S.mySlots[S.selectedSlot]),e.$emit("Keychange"))}function g(e){var t=document.getElementById("treeitem"+e.$modelValue.id);t.setAttribute("contentEditable",!0);var n=t.firstChild,r=n.length,o=document.createRange();o.setStart(n,0),o.setEnd(n,r);var i=window.getSelection();i.removeAllRanges(),i.addRange(o),t.focus()}function p(e){function t(e){var t=S.mySlots[e].title,n=r.getGetter(t)();r.getSetter(t)(),r.getSetter(n)();var o=r.getGetter("myslots")();delete o[e],r.getSetter("myslots")(o)}function n(e){function t(e){for(var r=0;r<e.length;r++)e[r].isDirectory?e[r].nodes.length>0&&t(e[r].nodes):n.push(e[r].id)}var n=[],r=e.$childNodesScope.$modelValue;return t(r),n}function o(e){for(var t=e;null!==t.$parentNodeScope;)t=t.$parentNodeScope;return t}function i(t,n){if(n)return n;for(var r=0;r<t.length;r++){if(!t[r].isDirectory&&t[r]!==e.$modelValue){n=!0;break}t[r].nodes.length>0&&(n=i(t[r].nodes,n))}return n}function a(e,t){for(var n=0;n<e.length;n++)if(e[n].isDirectory&&e[n].id!==t)return!0}var l=(e.$modelValue.id,o(e)),s=e.$modelValue.isDirectory,c=0;if(s)for(var u=e;null!==u&&c<10;){if(a(u.$parentNodesScope.$modelValue,e.$modelValue.id)){var d=n(e);d.length<Object.keys(S.mySlots).length&&(d.forEach(function(e){t(e),delete S.mySlots[e]}),e.remove());break}u=u.$parentNodeScope,c++}else i(l.$parentNodesScope.$modelValue,!1)&&(t(e.$modelValue.id),delete S.mySlots[e.$modelValue.id],e.remove())}function h(e){e.toggle()}function v(e){var t=e.$modelValue;if(t.isDirectory)t.nodes.push({id:Math.floor(1e4*Math.random()),title:t.title,isDirectory:!0,nodes:[]});else{var n=Math.floor(1e4*Math.random()),o=t.title+"-"+y(),i={id:n,title:o,isDirectory:!1,isLocked:!1,nodes:[]};null!==e.$parentNodeScope?e.$parentNodeScope.$modelValue.nodes.push(i):S.list.push(i),r.getNewSlotname(o,n),S.mySlots[n]={title:o,isLocked:!1},m(i)}}function y(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHILJKLMNOPRSTUVWXYZ",t="",n=0;n<3;n++){var r=Math.floor(Math.random()*e.length),o=e.substring(r,r+1);t+=o}return t}var S=this;S.remove=p,S.toggle=h,S.setSelectedSlot=m,S.changeName=g,S.newSubitem=v,S.modifyAlias=f,S.getZip=d,S.addFileOrFolder=c,S.saveToFile=s,S.showZipDialog=l,S.treeOptions={},u(),e.$on("KeySwitch",function(e,t){for(var n=Object.keys(S.mySlots),r=0;r<n.length;r++)if(S.mySlots[n[r]].title==t.title){var o={id:n[r],title:n[r].title,isLocked:n,nodes:[],isDirectory:!1};m(o)}}),e.$watch("vm2.selectedSlot",function(){}),e.$watch("vm2.list",function(){r.getSetter("thejson")(S.list)},!0)}]).controller("LoadZipController",["$uibModalInstance","ZipService","items",function(e,t,n){function r(){t.getZip().then(function(t){e.close({returntype:"viahttp",data:t})},function(e){})}function o(){e.close("dialog cancelled.")}var i=this;i.closeModal=o,i.getZipOverHttp=r}]).filter("cropFilter",function(){return function(e){if(void 0===e)return"";var t=e.substring(e.lastIndexOf("/")+1,e.length);return t.length>0?t:e}})}(),function(){angular.module("confab").factory("xmlTag",function(){function e(e,t){this.tagType="STARTTAG",this.elementName=e,tagProperties={},t.forEach(function(e){tagProperties[e.getAttributeName()]=e.getAttributeValues()}),this.tagProperties=tagProperties}var t=["FixedQuerySender","XmlWellFormedChecker","XmlValidator","XmlSwitch","XmlIf","WsdlXmlValidator","RemoveFromSession","PutSystemDateInSession","PutInSession","MailSender","LogSender","Json2XmlValidator","JmsCommunicator","PutParametersInSession","IsolatedServiceExecutor","IsolatedServiceCaller","IfMultipart","GetFromSession","FixedResultSender","FixedResult","FilenameSwitch","XmlParamSwitch","EchoSender"];return e.prototype={getTagType:function(){return this.tagType},setTagType:function(e){switch(e){case"STARTTAG":this.tagType="STARTTAG";break;case"COMBITAG":this.tagType="COMBITAG";break;case"ENDTAG":this.tagType="ENDTAG";break;default:this.tagType="STARTTAG"}},toCompleteTag:function(){var e="",t="";return this.convertToPipe(),angular.forEach(this.tagProperties,function(e,n){t+=""==e?" "+n+'=""  ':" "+n+'="'+e+'"'}),e="<"+this.elementName+t+"></"+this.elementName+">"},toObject:function(){var e={};return e[this.elementName]=this.tagProperties,e},setProperty:function(e,t){this.tagProperties[e]=t},getPropertyValue:function(e){return this.tagProperties[e]},convertToPipe:function(){this.elementName.search(/^.*Pipe$/)!==-1&&(this.elementName="pipe"),t.includes(this.elementName)&&(this.elementName="pipe")}},e}).factory("attributeObject",function(){function e(e,t,n){this.name=e,void 0!==t?this.values=t:this.values=[],void 0!==n?this.hasDefault=n:this.hasDefault=!1}return e.prototype={setAttributeValue:function(e){this.hasDefault?this.values.unShift(e):this.values.push(e)},insertValues:function(e){this.values=e},getAttributeName:function(){return this.name},getAttributeValues:function(){return this.values},setDefaultValue:function(e){this.hasDefault=e},toString:function(){return this.name+"Allowed values:"+this.values.join()}},e})}();
//# sourceMappingURL=scripts.min.js.map
