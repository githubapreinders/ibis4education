{"version":3,"sources":["scripts.min.js"],"names":["app","angular","module","config","$stateProvider","$urlRouterProvider","console","log","state","url","views","content","templateUrl","controller","content@","otherwise","$scope","$interval","$timeout","$uibModal","xmlTag","attributeObject","StaticDataFactory","StorageFactory","EditorFactory","ValidationFactory","IafFactory","ZipService","ModeratorFactory","toggleTab","thetab","vm","showeditor","showauth","elem","document","getElementById","classList","toggle","theothers","_","without","thetabs","forEach","el","ele","remove","saveInSlot","getTimerId","timerId","showSpinnerSmall","thekey","getGetter","getCurrentKey","title","cropFilter","getSetter","thedocument","getValue","setTimerId","item","undefined","helper","substring","lastIndexOf","length","toggleSpinner","showSpinner","sendZip","then","res","style","background","err","setCredentials","iaf_url","username","password","resp","navigatorModel","JSON","parse","data","JSONMONSTER","MYMONSTER","toggle_datasource","showCredentialsDialog","modalInstance","open","size","resolve","items","result","validateXml","currentKey","validationMessage","changeFontSize","ed","getElementsByClassName","fontSize","selectedFontSize","toString","getEditor","_editor","editor","editorLoaded","getDoc","getJson","response","setOption","schemaInfo","foldCode","CodeMirror","Pos","lineCount","showNav","showConf","retrieveData","toggleReadonly","akey","isLocked","setReadonly","val","unlock","changeTheme","selectedTheme","modifyAlias","slotn","newname","toggleSlot","key","switchKey","$broadcast","storeData","myalias","myvalue","mykey","alias","Date","now","setValue","navigator","showConfig","left","navItem","picture","iplogo","showNavigator","width","top","add","setSelectedClass","selectedItem","setSelectedItem","selectedProperties","i","properties","checkbox","click","thetype","setDataSource","datasource","getDataSource","showPropertyDescription","done","parking","Object","keys","type","clearEditor","getOption","setCursor","line","lastLine","ch","focus","styleEditorContent","isTheBetter","newpos","oldpos","standard","linedifference1","Math","abs","linedifference2","chardifference1","chardifference2","pos","getCursor","before","getRange","beforesegment","match","after","aftersegment","cursor","getSearchCursor","counter","original","myindex","find","newval","to","settings","getFormattingSettings","html_beautify","checkDefaults","property","Array","submitForm","replaceSelection","xml","theproperties","push","newtag","classname","toCompleteTag","this","codemirrorLoaded","message","userInput","showFullEditor","showValidationMessage","initialise","themes","getThemes","fontSizes","getFontSizes","availableLessons","$on","cancel","$uibModalInstance","submitCredentials","close","vm4","closeModal","dismiss","filter","filtered","sort","a","b","x","toLowerCase","y","newstring","replace","newerstring","directive","restrict","link","scope","attrs","bind","event","traverseArray","sublist","id","digit","theobject","element","$parentNodesScope","$modelValue","siblings","s","text","innerHTML","alert","vm2","mySlots","theslot","oldalias","changeKeys","myslots","setAttribute","$apply","list","nodes","target","thelist","code","which","keyCode","eventt","charCode","preventDefault","blur","heading","itemnumber","elemt","input","checked","value","info","require","ngModel","read","$setViewValue","html","$render","$viewValue","oldvalue","vm3","selectedProperty","newvalue","theattrs","defineProperty","getOwnPropertyDescriptor","dataModel","postJsonBulk","description","checkForXml","loadXml","addNewClass","newProperty","addingProperty","addingItem","otherSlot","currentSlotNumber","myslot","changeAttr","index","addProperty","string","propname","propdes","propdef","unshift","deleteProperty","splice","showModel","windowClass","postDatamonster","confirmDelete","animation","backdrop","deleteItem","stopTimer","getStaticJson","getSelectedItem","vm5","stringify","vm6","factory","$http","setAvailableLesson","availableLesson","getAvailableLessons","json","post","API_URL","postSchema","datamonster","thetag","method","IAF_URL","headers","content-type","status","postTag","tag","constant","setIafUrl","timerid","formattingSettings","get","thejson","indent_size","end_with_newline","js","css","preserve-newlines","DOWNLOAD_URL","UPLOAD_URL","PROJECTNAME","init","getSlots","getMySlots","saveas","Promise","reject","zip","JSZip","elements","querySelectorAll","object","parents","$parentNodeScope","filename","pop","isDirectory","folder","file","timestamp","generateAsync","myzip","blob","Blob","saveAs","postConfig","finalurl","fileName","fd","FormData","append","Content-type","getZipFromFile","loadAsync","storeZip","myzipfiles","async","newslotname","ceil","random","name","isParent","possibleparent","candidate","deleteAll","relativePath","indexOf","myjson","dir","myobj","val1","val2","split","parentsfound","copy","j","getZip","finalUrl","responseType","setCurrentKey","storage","$log","getKeys","2","thekeys","createKeys","oldname","islocked","shift","getNewSlotname","createdAlias","theid","getAliases","output","thealiases","verifyKey","api","setter","getter","isUndefined","Error","hasOwnProperty","createAPIForKey","createSetter","createGetter","isDefined","set","error","completeAfter","cm","pred","setTimeout","completionActive","showHint","completeSingle","Pass","completeIfAfterLt","cur","completeIfInTag","tok","getTokenAt","test","charAt","inner","innerMode","getMode","tagName","bothTags","extraKeys","'<'","'/'","' '","'='","Ctrl-Space","options","windowheight","window","innerHeight","navbarheight","offsetHeight","querySelector","height","server","uname","pw","showZipDialog","rendered","zipfromfile","addEventListener","files","returntype","setSelectedSlot","saveToFile","addFileOrFolder","newobject","floor","createRandomSuffix","$emit","selectedSlot","changeName","textnode","firstChild","caret","range","createRange","setStart","setEnd","sel","getSelection","removeAllRanges","addRange","deleteFromLocalStorage","itsid","thealias","deleteContainingFiles","findResults","results","$childNodesScope","array","getRoot","obj","ok","lookForDirectory","callerid","nodetype","currentLayer","newSubitem","theitem","thetitle","suffixes","randomdigit","letter","treeOptions","$watch","getZipOverHttp","elementname","proparray","tagType","elementName","tagProperties","prop","getAttributeName","getAttributeValues","staticPipenames","prototype","getTagType","setTagType","astring","returnstring","itsproperties","convertToPipe","toObject","setProperty","getPropertyValue","search","includes","regex","attributename","values","hasDefault","setAttributeValue","unShift","insertValues","setDefaultValue","bool","join"],"mappings":"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","file":"scripts.min.js","sourcesContent":["(function()\n{\n    var app = angular.module('confab',['ngAnimate','ui.bootstrap','ui.tree', 'ui.router', 'ui.codemirror','ngCookies','angularLocalStorage']);\n\n\napp.config(function ($stateProvider, $urlRouterProvider)\n{\n    console.log('Application config...');\n    $stateProvider\n\n        // route for the home p age\n        .state('app', {\n            url: '/',\n            views: {\n                'content': {\n                    templateUrl: 'views/home.html',\n                    controller: 'IndexController as vm'\n                }\n            }\n        })\n        .state('app.moderator', {\n            url:'moderator',\n            views: {\n                'content@': {\n                    templateUrl : 'views/moderator.html',\n                    controller  : 'ModeratorController as vm3'\n                }\n            }\n        });\n    $urlRouterProvider.otherwise('/');\n\n    \n});\n\n})();\n(function (){\n    'use strict';\n\n    angular.module('confab')\n        .controller('IndexController', function ($scope, $interval, $timeout, $uibModal, xmlTag, attributeObject, StaticDataFactory, StorageFactory, EditorFactory, ValidationFactory, IafFactory, ZipService,ModeratorFactory)\n        {\n\n            console.log('IndexController...');\n            var vm = this;\n        \n            //Functions\n            vm.submitForm = submitForm;\n            vm.codemirrorLoaded = getEditor;\n            vm.setSelectedClass = setSelectedClass;\n            vm.toggle_datasource = toggle_datasource;\n            vm.styleEditorContent = styleEditorContent;\n            vm.clearEditor = clearEditor;\n            vm.showNav = showNav;\n            vm.showConf = showConf;\n            vm.storeData = storeData;\n            vm.retrieveData = retrieveData;\n            vm.toggleSlot = toggleSlot;\n            vm.modifyAlias = modifyAlias;\n            vm.checkDefaults = checkDefaults;\n            vm.changeTheme = changeTheme;\n            vm.changeFontSize = changeFontSize;\n            vm.validateXml = validateXml;\n            vm.sendZip = sendZip;\n            vm.toggleSpinner = toggleSpinner;\n            vm.setCredentials = setCredentials;\n           // vm.setAvailableLesson = setAvailableLesson;\n            vm.toggleReadonly = toggleReadonly;\n            vm.unlock = unlock;\n\n            //Static values\n            vm.message = \"Angular Controller is working allright...\";\n            vm.userInput = \"\";\n            vm.datasource = StaticDataFactory.getDataSource();\n            vm.navigatorModel = null;\n            vm.selectedItem = null;\n            vm.showPropertyDescription = false;\n            vm.selectedProperties = {};\n            vm.showConfig = false;\n            vm.showNavigator = true;\n            vm.showFullEditor = false;\n            var editor = null;\n            var thedocument = null;    \n            vm.timerId = null;\n            vm.showValidationMessage = false;\n            vm.validationMessage = null;\n            vm.currentKey = StorageFactory.getCurrentKey();\n            vm.iaf_url = StorageFactory.getGetter(\"IAF_URL\")();\n            var avalue = StorageFactory.initialise();\n\n\n            //Editor Styling\n            vm.themes = StaticDataFactory.getThemes();\n            vm.selectedTheme = \"twilight\";\n            vm.selectedFontSize = 14;\n            vm.fontSizes = StaticDataFactory.getFontSizes();\n            \n            vm.availableLessons = [];\n\n            //tabs control\n            vm.toggleTab = toggleTab;\n            vm.thetabs=[\"tabauth\", \"tabedit\"];\n            toggleTab('tabauth');//initializing\n\n            function toggleTab(thetab)\n            {   \n                switch(thetab)\n                {\n                    case(\"tabauth\"):{vm.showeditor = false;vm.showauth = true;break;}\n                    case(\"tabedit\"):{vm.showeditor = true;vm.showauth = false;break;}\n                }\n\n                var elem = document.getElementById(thetab);\n                elem.classList.toggle('active1');\n                var theothers = _.without(vm.thetabs, thetab);\n                theothers.forEach(function(el)\n                {\n                    var ele =  document.getElementById(el);\n                    ele.classList.remove('active1');\n                });\n                console.log(\"toggling tab\",vm.showeditor, vm.showauth);\n\n            }\n\n            function setAvailableLesson(which)\n            {\n                ModeratorFactory.setAvailableLesson(which);\n            }\n\n            //saves editor content in the localstorage slot that is open every 5 seconds, spinner indicates that \n            function saveInSlot()\n            {\n                if (StaticDataFactory.getTimerId() !== 0 )\n                {\n                    console.log(\"cancelling a timer...\");\n                 return;\n                }//avoiding running two timers...\n                \n                console.log(\"starting timer\");\n                vm.timerId = $interval(function()\n                {\n                    vm.showSpinnerSmall = true;\n                    $timeout(function()\n                    {\n                        vm.showSpinnerSmall = false;\n                    }, 1000);\n                    var thekey = StorageFactory.getGetter(StorageFactory.getCurrentKey().title)();\n                    console.log(\"saving : \", cropFilter(StorageFactory.getCurrentKey().title),\" with id \",vm.timerId);\n                    StorageFactory.getSetter(thekey)(thedocument.getValue());\n                }, 5000);\n                StaticDataFactory.setTimerId(vm.timerId);\n            }\n\n\n\n            $scope.$on('$destroy', function()\n            {\n                console.log(\"cancelling timer...\", typeof(vm.timerId));\n                $interval.cancel();\n            });\n\n            //setting the editor content after a new file has been chosen to edit\n            $scope.$on(\"Keychange\", function()\n            {\n                vm.currentKey = StorageFactory.getCurrentKey();\n                console.log(\"keychange\", vm.currentKey.title);\n                retrieveData(vm.currentKey);\n                toggleReadonly(vm.currentKey);\n            });\n\n\n            // after a switch in focus, saving the work that is just made\n            $scope.$on('saveOldValues',function()\n            {\n                    vm.showSpinnerSmall = true;\n                    $timeout(function()\n                    {\n                        vm.showSpinnerSmall = false;\n                    }, 1000);\n                    var thekey = StorageFactory.getGetter(StorageFactory.getCurrentKey().title)();\n                    console.log(\"saving : \", cropFilter(StorageFactory.getCurrentKey().title));\n                    StorageFactory.getSetter(thekey)(thedocument.getValue());\n            });\n\n            function cropFilter(item)\n            {\n                if(item === undefined) return \"\";\n                var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\n                if(helper.length > 0)\n                {\n                    return helper;\n                }\n                else\n                {\n                    return item;\n                }\n            }\n\n            \n            //show a spinner while waiting for a response\n            function toggleSpinner()\n            {\n                vm.showSpinner = !vm.showSpinner;\n            }\n\n            //send the current configuration to the framework.\n            function sendZip()\n            {   \n                toggleSpinner();\n                //saving the current file before uploading it...\n                var thekey = StorageFactory.getGetter(StorageFactory.getCurrentKey().title)();\n                console.log(\"saving : \", cropFilter(StorageFactory.getCurrentKey().title));\n                StorageFactory.getSetter(thekey)(thedocument.getValue());\n                ZipService.sendZip().then(function succes(res)\n                {\n                    toggleSpinner();\n                    var el = document.getElementById('sendstatus');\n                    el.style.background = 'green';\n                    $timeout(function()\n                        {\n                            el.style.background = 'none';\n                        }, 5000);\n                    console.log(\"successful response\",res);\n                },function failure(err)\n                {\n                    var el = document.getElementById('sendstatus');\n                    el.style.background = 'red';\n                    toggleSpinner();\n                   $timeout(function()\n                   {\n                            el.style.background = 'none';\n                        }, 5000);\n                    console.log(\"error from zipservice sending zip\",err);\n                });\n            }\n\n            function setCredentials()\n            {\n                console.log(\"credentials:\", vm.iaf_url);\n                IafFactory.setCredentials(vm.iaf_url, vm.username, vm.password).then(\n                function succes(resp)\n                {\n                    console.log(\"setting credentials and updating the scope\");    \n                    vm.navigatorModel = JSON.parse(resp.data.JSONMONSTER.MYMONSTER);\n                    toggle_datasource('pipes');\n                },\n                function fail(err)\n                {\n\n                });\n            }\n\n\n            function showCredentialsDialog()\n            {\n\n                var modalInstance = $uibModal.open(\n                {\n                    templateUrl : \"./views/modalcredentials.html\",\n                    controller : \"LoadCredentialsController as vm4\",\n                    size : \"md\",\n                    resolve : {items : function ()\n                        {\n                            return \"something\";\n                        }}\n                });\n\n                modalInstance.result.then(\n                function success(resp)\n                {\n                    console.log(\"response: \" , resp);\n                    vm.iaf_url = resp.iaf_url;\n                    vm.username = resp.username;\n                    vm.password = resp.password;\n                    setCredentials();\n\n\n                }\n                ,function failure(err)\n                {\n                    console.log(\"no result from modal...\");\n                });\n            }\n\n\n\n            function postSnippet()\n            {\n                StaticDataFactory.postSnippet(vm.currentKey.title).then(function (res)\n                {\n                    console.log(\"response\", res);\n                },\n                function (err)\n                {\n                    console.log(\"response\", err);\n                });\n            }\n\n\n\n\n\n            function validateXml()\n            {\n                toggleSpinner();\n                ValidationFactory.validateXml(vm.currentKey.title).then\n                (\n                    function success(res)\n                    {\n                        vm.validationMessage = res;\n                        toggleSpinner();\n                        console.log(\"validating....\", vm.validationMessage);\n                    }, \n                    function failure(err)\n                    {\n                        toggleSpinner();\n                    }\n                );\n                \n            }\n\n            function changeFontSize()\n            {   \n                var ed = document.getElementsByClassName('CodeMirror')[0];\n                ed.style.fontSize = vm.selectedFontSize.toString() + 'px';\n            }\n\n            //initialisation of editor(triggered by attribute in home.html), datamodel, and cache\n            function getEditor(_editor)\n            {\n                editor = EditorFactory.editorLoaded(_editor);\n                thedocument = editor.getDoc();\n                if(StorageFactory.getGetter('IAF_URL')() === null || StorageFactory.getGetter('IAF_URL')() === undefined)\n                {\n                    showCredentialsDialog();\n                }\n\n                else\n                {\n                    StaticDataFactory.getJson().then(\n                    function success(response)\n                    {\n                        vm.navigatorModel = JSON.parse(response.data.JSONMONSTER.MYMONSTER);\n                        console.log(\"returned datamodel : \\n\", vm.navigatorModel);\n                        editor.setOption('hintOptions', {schemaInfo: vm.navigatorModel});\n                        editor.foldCode(CodeMirror.Pos(0,0));\n                        editor.foldCode(CodeMirror.Pos(thedocument.lineCount(),0));\n                        toggle_datasource('pipes');\n                        showNav(); \n                        showConf();\n                        showConf();\n\n                    \n                        //initialising the cache and loading it in the editor;\n                        // var avalue = StorageFactory.initialise();\n                        retrieveData();\n                        saveInSlot();\n\n                    },function error(response)\n                    {\n                        console.log(\"error initialising:\", response.data);\n                    });\n                }\n                \n            }\n\n            //receiving object\n            function toggleReadonly(akey)\n            {\n                console.log(\"toggling lock\", akey.title, akey.isLocked);\n                setReadonly(akey.isLocked);\n            }\n\n            function setReadonly(val)\n            {\n                editor.setOption('readOnly', val);\n            }\n\n            function unlock(akey)\n            {\n                setReadonly(false);\n            }\n\n            function changeTheme()\n            {\n                editor.setOption('theme', vm.selectedTheme);\n            }\n                \n            //responds to change of the slotname : internally the slotnames are slot1, slot2...etc,\n            //externally a user can choose any alias he wants.\n            function modifyAlias(slotn, newname)\n            {\n                console.log(\"modify \",slotn, newname);\n                StorageFactory.getSetter(slotn)(newname);\n            }\n\n            //console.log(\"retrieved keys\",StorageFactory.getKeys());\n            \n            function toggleSlot()\n            {\n                // console.log(\"slot: \", typeof (slot) , vm.currentSlotNumber);\n                //opening a slot from the key item in the navigator\n                vm.showSpinnerSmall = true;\n                $timeout(function()\n                {\n                    vm.showSpinnerSmall = false;\n                }, 1000);\n\n                //$scope.$emit('saveOldValues');\n\n                // console.log(\"saving \", StorageFactory.getCurrentKey().title);\n                // var thekey = StorageFactory.getGetter(StorageFactory.getCurrentKey().title)();\n                // StorageFactory.getSetter(thekey)(thedocument.getValue());\n\n\n\n                console.log(\"getting next document:\");\n                var key = StorageFactory.switchKey();\n                console.log(\"returned key\", key);\n                $scope.$broadcast('KeySwitch',key);\n                retrieveData(key);\n                //setReadonly(vm.theslots[vm.currentSlotNumber-1].locked);\n                // console.log(\"Current slotprops:\",vm.theslots[vm.currentSlotNumber-1]);\n            }\n\n            function storeData()\n            {\n                var myalias = StorageFactory.getCurrentKey().title;\n                var myvalue = thedocument.getValue();\n                var mykey = StorageFactory.getGetter(myalias)();\n                console.log(\"storing data\", myalias, mykey, myvalue);\n                StorageFactory.getSetter(mykey)(myvalue);\n            }\n\n            // key is an object\n            function retrieveData(alias)\n            {\n                if(alias === undefined)\n                {\n                    alias = StorageFactory.getCurrentKey();\n                }\n                console.log(\"alias\", alias);\n                if(StorageFactory.getGetter(alias.title)() === undefined)\n                {\n                    $timeout(function() \n                    {\n                        console.log(\"waiting for StorageFactory to settle...\", Date.now());\n                        var thekey = StorageFactory.getGetter(alias.title)();\n                        // console.log(\"retrieving data , setting the document value...\", StorageFactory.getGetter(thekey)());\n                        thedocument.setValue(StorageFactory.getGetter(thekey)());\n                    }, 50);\n                }\n                else\n                {\n                    var thekey = StorageFactory.getGetter(alias.title)();\n                    // console.log(\"retrieving data and setting the document value...\", StorageFactory.getGetter(thekey)());\n                    thedocument.setValue(StorageFactory.getGetter(thekey)());\n                }\n                if(StaticDataFactory.getTimerId() === 0 )\n                {\n                    saveInSlot();\n                }\n            }\n\n            //toggles the configuration menu in the left area;\n            function showConf()\n            {\n                var navigator = document.getElementById('navigatorcontainer');\n                 \n                if(vm.showConfig)\n                {\n                  navigator.style.left = \"0%\";\n                }\n                else\n                {\n                  navigator.style.left = '-25%';\n                }\n                vm.showConfig = !vm.showConfig;\n            }\n                \n\n              //toggles the editor area to 75 or 100%\n              function showNav()\n              {\n                var editor = document.getElementById('editorcontainer');\n                var navItem = document.getElementById('navItem');\n                var picture = document.getElementById('picture');\n                var iplogo = document.getElementById('iplogo');\n                \n                if(!picture || !navItem || !editor){return;}\n\n\n                if(vm.showNavigator)\n                {\n                  editor.style.width = '75%';\n                  editor.style.left = '25%';\n                  iplogo.style.top = '10px';\n                  navItem.style.left = '89%';\n                  picture.classList.add('fa-toggle-left');\n                  picture.classList.remove('fa-toggle-right');\n                }\n                else\n                {\n                  editor.style.width = '100%';\n                  editor.style.left = '0%';\n                  navItem.style.left = '0%';\n                  iplogo.style.top = '10px';\n                  picture.classList.remove('fa-toggle-left');\n                  picture.classList.add('fa-toggle-right');\n                }\n                vm.showNavigator = !vm.showNavigator;\n              }\n\n           \n\n\n            //responds to the selection of an item in the class Area;\n            function setSelectedClass(item)\n            {\n                vm.selectedItem = item;\n                StaticDataFactory.setSelectedItem(item);\n                vm.selectedProperties = {};\n                \n                //checking a default classname property\n                for(var i=0 ; i<item.properties.length; i++)\n                {\n                    if(item.properties[i][0]=='classname' || item.properties[i][0]=='className')\n                    {\n                        var checkbox = document.getElementById('checkbox' + i);\n                        if(checkbox === null)\n                        {\n                            break;\n                        }\n                        checkbox.click();\n                        break;\n                    }\n                }\n\n            }\n\n\n\n            //responds to the radiobuttons in the dataSource area and switches to pipe, receiver, snippet or general; the first item of \n            //the chosen type is selected.\n            function toggle_datasource(thetype)\n            {\n                StaticDataFactory.setDataSource(thetype);\n                vm.datasource = StaticDataFactory.getDataSource();\n                vm.showPropertyDescription = false;\n                \n                var done = false;\n                var parking = \"zzz\";\n                Object.keys(vm.navigatorModel).forEach(function(key)\n                {\n                    if (!done && vm.navigatorModel[key].type === thetype )\n                    {\n                        if (key < parking)\n                        {\n                            parking = key;\n                        }\n                        //vm.selectedItem = vm.navigatorModel[key];\n                        //vm.selectedProperties = {};\n                    }\n                });\n                setSelectedClass(vm.navigatorModel[parking]);\n\n\n                // console.log(\"vm.datasource\", vm.datasource);\n            }\n\n            //empties the editor\n            function clearEditor()\n            {\n                if(editor.getOption('readOnly') === true)\n                {\n                    return;\n                }\n                thedocument.setValue(\"<?xml version='1.0' encoding='UTF-8'?>\\n\");\n                thedocument.setCursor({line:thedocument.lastLine(),ch:0});\n                editor.focus();\n            }\n\n            //Responding to the style button in the navbar\n            function styleEditorContent()\n            {\n                //get the currunt cursor position of the editor; check between which values that is and look that up\n                // after reformatting the text to replace the cursor.\n                var pos = thedocument.getCursor();\n                var before = thedocument.getRange({line:pos.line,ch:0},pos);\n                //regex to find tag segment left of the cursor : <[\\w\\/\\s=\\'\\\"]+$|<[\\w\\/\\s=\\'\\\"]+>$\n                var beforesegment = before.match(/<[\\w\\/\\s=\\'\\\"]+$|<[\\w\\/\\s=\\'\\\"]+>[\\w\\s]*$/);\n                if (beforesegment !== null)\n                {\n                    before = beforesegment[0];\n                }\n                var after = thedocument.getRange(pos,{line:pos.line,ch:null});\n                //regex to find tag segment to the right of cursor : ^[\\w\\/\\s=\\'\\\"]+>|^<[\\w\\/\\s=\\'\\\"]+> \n                var aftersegment = after.match(/^[\\w\\/\\s=\\'\\\"]+>|^<[\\w\\/\\s=\\'\\\"]+>/);\n                if (aftersegment !== null)\n                {\n                    after = aftersegment[0];\n                }\n\n                //search the correct position of the cursor, possibly many similar tags : the index of the search results\n                //array is stored\n                var cursor = editor.getSearchCursor(before);\n                var counter =0 ;\n                var original = {line:10000,ch:10000};\n                var myindex = -1;\n                while (cursor.find() === true)\n                {   \n                    var newval = cursor.to();\n                    if (isTheBetter(pos, newval, original))\n                    {\n                        original = newval;\n                        myindex = counter;\n                    }\n                    counter++;\n                }\n                //now that we know we can find the new cursor position we will format the complete text\n                var settings = StaticDataFactory.getFormattingSettings();\n                thedocument.setValue(html_beautify(thedocument.getValue(),settings));\n\n                //put the cursor back in place\n                cursor = editor.getSearchCursor(before);\n                for(var i=0 ; i < myindex+1 ;i++)\n                {\n                    cursor.find();\n                }\n                if(cursor.to())\n                {\n                    thedocument.setCursor(cursor.to());\n                }\n                editor.focus();\n\n\n                function isTheBetter(newpos, oldpos, standard)\n                {\n                    var linedifference1 = Math.abs(standard.line - oldpos.line);\n                    var linedifference2 = Math.abs(standard.line - newpos.line);\n                    if (linedifference1 > linedifference2)\n                    {\n                        return false;\n                    }\n                    if(linedifference2 > linedifference1)\n                    {\n                        return true;\n                    }\n                    var chardifference1 = Math.abs(standard.ch - oldpos.ch);\n                    var chardifference2 = Math.abs(standard.ch - newpos.ch);\n                    if (chardifference1 > chardifference2)\n                    {\n                        return false;\n                    }\n                    return true;\n                }\n            }\n\n\n            //determines to check a value in the property area because they are obligatory;\n            function checkDefaults(property)\n            {\n                if(property[0] === 'classname' || property[0] === 'className')\n                {\n                    vm.selectedProperties[property[0]] = new attributeObject('className', new Array(property[2]));\n                    return true;\n                }\n                return false;\n            }\n\n\n/*Responds to the arrow button in the navBar. The current selected item and the current selected properties are converted\nto a string and inserted in the editor;*/\n\n            function submitForm()\n\n            {\n\n                if (vm.selectedItem === null || editor.getOption('readOnly') === true)\n                {\n                    return;\n                }\n                if(vm.selectedItem.type === 'snippets')\n                {\n                    console.log(\"selectedItem:\",vm.selectedItem);\n                    //loadXml(vm.selectedItem.file);\n                    thedocument.replaceSelection(vm.selectedItem.xml);\n                }\n                else\n                {\n                    var theproperties = [];    \n                    console.log(\"props:\", vm.selectedProperties);\n                    if (Object.keys(vm.selectedProperties).length > 0 )\n                    {\n                        Object.keys(vm.selectedProperties).forEach(function(thekey)\n                        {\n                            \n                            theproperties.push(vm.selectedProperties[thekey]);\n                        }); \n                    }\n                   var newtag = new xmlTag(vm.selectedItem.classname, theproperties);\n                    thedocument.replaceSelection(newtag.toCompleteTag());\n                    editor.focus();\n                }\n            }\n        })\n\n    .controller('LoadCredentialsController', function($uibModalInstance, items)\n    {\n        console.log(\"loading credentials...\");\n        var vm4 = this;\n        vm4.iaf_url = null;\n        vm4.username = null;\n        vm4.password = null;\n        vm4.submitCredentials = submitCredentials;\n        vm4.closeModal = closeModal;\n\n        function submitCredentials()\n        {\n            console.log(\"returning with credentials...\");\n            $uibModalInstance.close({iaf_url:vm4.iaf_url, username: vm4.username, password: vm4.password});\n        }\n\n        function closeModal()\n        {\n           $uibModalInstance.dismiss();\n        }\n    })\n\n\n    /*determines which classes are shown in the navigator, based on the JSON item type (pipes, receivers, general or snippets)*/\n    .filter('datasourceFilter', function(StaticDataFactory)\n    {\n        return function(items)\n        {\n            var filtered = [];\n            angular.forEach(items, function(item)\n            {\n               if (item.type === StaticDataFactory.getDataSource())\n                {\n                    filtered.push(item);\n                }\n            });\n            //sorting the resulting array of objects on the classname property.\n            filtered.sort(function(a,b)\n                {\n                    var x = a.classname.toLowerCase();\n                    var y = b.classname.toLowerCase();\n                    if (x < y) {return -1;}\n                    if (x > y) {return 1;}\n                    return 0;\n                });\n            return filtered;\n        };\n    })\n\n\n    //replaces escaped tag signs with the proper symbols, used in the description area where sometimes strange symbols appear.\n    .filter('cleanupFilter', function()\n    {\n        return function(item)\n        {\n\n            if(item !== undefined)\n            {\n                var newstring = item.replace(/&lt;/g,'<');\n                var newerstring = newstring.replace(/&gt;/g,'>');\n                return newerstring;\n            }\n        };\n    });\n\n})();\n(function()\n{\n\t'use strict';\n\nangular.module('confab')\n\n/*Part of the file navigator (node_template.html) changing the name of a file of directory neeeds to be updated\nIn local storage. For this the old and the new name have to be in one place.*/\n.directive('nameGiver', function(StorageFactory)\n        {\n            return{\n                restrict:\"A\",\n                link : function(scope, el , attrs)\n                {\n                    el.bind('blur' , function(event)\n                    {\n                        var digit = event.target.id.match(/\\d+/g)[0];\n                        console.log(\"digit\", digit, event.target.id);\n                        var element = document.getElementById('treeitem' + digit);\n                        var text = element.innerHTML;\n                        var thelist = scope.vm2.list;\n                        console.log(\"text\",text, thelist, digit);\n                        traverseArray(thelist);\n\n                        function traverseArray(sublist)\n                        {\n                            for(var i = 0 ; i<sublist.length; i++)\n                            {\n\n                                console.log(sublist[i].title,sublist[i].id);\n                                //compares int with a string, so NOT === in the comparator\n                                if(sublist[i].id == digit) \n                                {\n\n                                    /*check if there's no sibling node with the same title, otherwise\n                                    we will get name collisions and data loss in the local storage*/\n                                    var theobject = angular.element(element).scope();\n                                    console.log(\"siblings: \", theobject.$parentNodesScope.$modelValue);\n                                    var siblings = theobject.$parentNodesScope.$modelValue;\n                                    for(var s = 0 ; s < siblings.length; s++)\n                                    {\n                                        if(siblings[s].title == text)\n                                        {\n                                            element.innerHTML = cropFilter(theobject.$modelValue.title);\n                                            alert(\"please no double names in this directory!\");\n                                            return;\n                                        }\n                                    }\n\n                                    sublist[i].title = text;\n                                    console.log(\"match\", sublist[i], text, scope.vm2.mySlots);\n                                    if(!(sublist[i].isDirectory))\n                                    {\n                                        //changing a filename changes the alias of a storageslot;\n                                        //\"oldname:slot1\" has to become \"newname:slot1\"\n                                        var theslot = StorageFactory.getGetter(scope.vm2.mySlots[digit].title)();\n                                        var oldalias = scope.vm2.mySlots[digit].title;\n                                        StorageFactory.changeKeys(oldalias,text);//keeping track of keys array and currentkey\n                                        StorageFactory.getSetter(oldalias)();//removing old alias\n                                        StorageFactory.getSetter(text)(theslot);//adding the new value\n                                        scope.vm2.mySlots[digit].title = text; //updating the current working files\n                                        var myslots = StorageFactory.getGetter(\"myslots\")();\n                                        myslots[digit].title = text;\n                                        StorageFactory.getSetter(\"myslots\")(myslots);//updating the working files in localstorage\n                                    }\n                                    element.setAttribute('contentEditable', false);\n                                    scope.$apply();\n                                    StorageFactory.getSetter(\"thejson\")(scope.vm2.list);//saving changed json\n                                    break;\n                                }\n                                if(sublist[i].nodes.length > 0)\n                                {\n                                    traverseArray(sublist[i].nodes);\n                                }\n                            }\n                        }\n\n                        function cropFilter(item)\n                        {\n                            if(item === undefined) return \"\";\n                            var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\n                            if(helper.length > 0)\n                            {\n                                return helper;\n                            }\n                            else\n                            {\n                                return item;\n                            }\n                        }\n\n\n                    });\n                    el.bind(['keydown'],function(event)\n                    {\n                        var code = event.which || event.keyCode || eventt.charCode ;\n                        console.log(\"code\", code);\n                        if (code === 13)// enter key\n                        {\n                            event.preventDefault();\n                            var element = document.getElementById('treeitem'+event.target.id.match(/\\d+/g));\n                            element.blur();\n                        } \n                    });\n                }\n            };\n        })\n\n.directive('propertyListener', function(attributeObject)\n{\n\t\n\treturn{\n\t\tlink : function(scope, elem, attrs)\n\t\t{\n\t\t\telem.bind('click', function(event)\n\t\t\t{\n\t\t\t\tvar heading = document.getElementById('propertyheader');\n\t\t\t\tvar text = document.getElementById('propertytext');\n\t\t\t\tconsole.log(\"clicked property\", event.target.id, heading.innerHTML);\n\t\t\t\tvar itemnumber = event.target.id.match(/\\d+$/)[0];\n\t\t\t\tvar data = scope.vm.selectedItem.properties[itemnumber];\n\t\t\t\theading.innerHTML = data[0];\n\t\t\t\ttext.innerHTML = data[1];\n\n\t\t\t\tvar elemt = document.getElementById('checkbox' + itemnumber);\n\t\t\t\tvar input = document.getElementById('propertyvalue' + itemnumber);\n\t\t\t\tvar item = scope.vm.selectedItem;\n\n\t\t\t\tconsole.log(\"items:\", elemt, input, item);\n\n\t\t\t\t/* a checked checkbox will be written onto vm.selectedProperties,\n\t\t\t\twhen it is unchecked we will want to remove it from there. */\n\t\t\t\t\n\t\t\t\tif(typeof (elemt) === 'object')\n\t\t\t\t\tswitch (elemt.checked)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase true :\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconsole.log(\"adding ...\");\n\t\t\t\t\t\t\tscope.vm.selectedProperties[data[0]] = new attributeObject(data[0], new Array(input.value));\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcase false : \n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconsole.log(\"deleting ...\");\n\t\t\t\t\t\t\tdelete scope.vm.selectedProperties[data[0]];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\tconsole.info(\"selected properties\",scope.vm.selectedProperties);\n\n\t\t\t});\n\t\t}\n\n\t};\n})\n\t/* \n\t when the change on the contenteditable happens the model binding has to\n     be invoked; also the property is a key in the attrs object ; so the old key name\n     is replaced by the new one here since at this place only the old and the new\n     value come together.\n     */\n.directive(\"contenteditable\", function() {\n  return {\n    restrict: \"A\",\n    require: \"ngModel\",\n    link: function(scope, element, attrs, ngModel) {\n\n      function read() {\n        ngModel.$setViewValue(element.html());\n      }\n\n      ngModel.$render = function() {\n        element.html(ngModel.$viewValue || \"\");\n      };\n      \n      element.bind(\"keyup change\", function(event) \n      {\n        console.log(\"changing property......\");\n        var el = event.target.id;\n        if(el !== 'newproperty' && el !== 'newclassname' && el !== 'newdescription')\n        {\n\t        var oldvalue = scope.vm3.selectedItem.properties[scope.vm3.selectedProperty][0];\n\t        scope.$apply(read);\n\t        var newvalue = scope.vm3.selectedItem.properties[scope.vm3.selectedProperty][0];\n\t        var theattrs = scope.vm3.selectedItem.attrs;\n\t        if(newvalue !== oldvalue)\n\t        {\n\t        \tObject.defineProperty(theattrs, newvalue,\n\t        \t\tObject.getOwnPropertyDescriptor(theattrs, oldvalue));\n\t        \tdelete theattrs[oldvalue];\n\t        }\n        }\n        else if(el !== 'newclassname'){\n        \tscope.$apply(read);\n        }\n      });\n      element.bind(\"blur\", function(event) \n      {\n        console.log(\"changing classname......\");\n        var el = event.target.id;\n        \n        if(el === 'newclassname') \n        {\n            var oldvalue = (scope.vm3.selectedItem.classname);\n            scope.$apply(read);\n            var newvalue = (scope.vm3.selectedItem.classname);\n            delete scope.vm3.dataModel[oldvalue];\n            scope.vm3.dataModel[newvalue] = scope.vm3.selectedItem;\n        }      \n        else{\n            scope.$apply(read);\n        }\n      });\n\n    }\n  };\n});\n\n\n\n}());\n(function()\n{\n\t'use strict';\n\tvar app = angular.module('confab');\n\t//TODO add a view and controller functionality to add items to the children array\n\tapp.controller('ModeratorController', function($scope, StaticDataFactory, $uibModal, StorageFactory, ModeratorFactory)\n\t{\n\t\tvar vm3 = this;\n\t\tvm3.showModel = showModel;\n\t\tvm3.deleteProperty = deleteProperty;\n\t\tvm3.changeAttr = changeAttr;\n\t\tvm3.addProperty = addProperty;\n\t\tvm3.addNewClass = addNewClass;\n\t\tvm3.otherSlot = otherSlot;\n\t\tvm3.postDatamonster = postDatamonster;\n\t\tvm3.checkForXml = checkForXml;\n\t\tvm3.postJsonBulk = postJsonBulk;\n\t\tvm3.confirmDelete = confirmDelete;\n\t\t\n\t\tconsole.log(\"moderatorcontroller attached...\");\n\t\tStaticDataFactory.stopTimer();\n\t\t\n\t\tvm3.dataModel = JSON.parse(StaticDataFactory.getStaticJson());\n\t\tconsole.log(vm3.dataModel);\n\t\tvm3.currentSlotNumber = StorageFactory.getCurrentKey().title;\n\t\tvm3.showPropertyDescription= false;\n\t\tvm3.selectedProperty = 0;\n\t\tvm3.addingProperty = false;\n\t\tvm3.newProperty = null;\n\t\tvm3.addingItem = false;\n\t\t\n\t\tif (vm3.dataModel === null)\n\t\t{\n\t\t\t\tconsole.log(\"resolving data from iaf data:\" );\n\t\t\t\tStaticDataFactory.getJson().then(function success(data)\n\t\t\t\t{\n\t\t\t\t\t\tvm3.dataModel = JSON.parse(data.data.JSONMONSTER.MYMONSTER);\n\t\t\t\t\t\tvm3.selectedItem = vm3.dataModel[(Object.keys(vm3.dataModel)[0])];\n\t\t\t\t\t\tconsole.log(\"selected itemm\",vm3.selectedItem);\n\t\t\t\t},\n\t\t\t\tfunction error(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.log(\"error\");\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvm3.selectedItem = StaticDataFactory.getSelectedItem();\n\t\t\tconsole.log(\"data2\", vm3.selectedItem);\n\t\t}\n\n\n\t\tfunction postJsonBulk()\n\t\t{\n\t\t\tModeratorFactory.postJsonBulk(vm3.selectedItem.description);\n\t\t}\n\n\t\tfunction checkForXml()\n\t\t{\n\t\t\tconsole.log(\"selected\",vm3.selectedItem.classname);\n\t\t\tStaticDataFactory.loadXml(vm3.selectedItem.classname).then(function success(res)\n\t\t\t{\n\t\t\t\tvm3.selectedItem.xml = res.data;\n\t\t\t});\n\t\t}\n\n\t\tfunction deleteItem()\n\t\t{\n\t\t\tModeratorFactory.deleteItem(vm3.selectedItem.classname).then(function succcess(res)\n\t\t\t\t{\n\t\t\t\t\tconsole.log(res);\n\t\t\t\t\tvar parking = vm3.selectedItem.classname;\n\t\t\t\t\tdelete vm3.dataModel[parking];\n\t\t\t\t\tvm3.selectedItem = vm3.dataModel[Object.keys(vm3.dataModel)[0]];\n\t\t\t\t},\n\t\t\t\tfunction fail(err)\n\t\t\t\t{\n\t\t\t\t\tconsole.log(err);\n\t\t\t\t});\n\t\t}\n\n\t\tfunction postJsonMonster()\n\t\t{\n\t\t\tconsole.log(\"JSONMONSTER\\n\",JSON.stringify(vm3.dataModel));\n\t\t}\n\n\n\n\t\t\n\n\t\tfunction addNewClass()\n\t\t{\n\t\t\tvm3.newProperty = null;\n\t\t\tvm3.addingProperty = false;\n\t\t\tvm3.addingItem = true;\n\t\t\tvm3.dataModel['NEWITEM'] = {classname:\"NEWITEM\",description:\"enter your description here\", type:\"general\",xml:\"\", attrs:{},properties:[]};\n\t\t\tvm3.selectedItem = vm3.dataModel['NEWITEM'];\n\t\t}\n\n\t\tfunction otherSlot()\n\t\t{\n\t\t\tvm3.currentSlotNumber = StorageFactory.switchKey().title;\n\t\t\tconsole.log(\"toggle slot\",vm3.currentSlotNumber);\n\t\t\t\n\t\t\tvar myslot = StorageFactory.getGetter(vm3.currentSlotNumber)();\n\n\t\t\tvm3.selectedItem.xml = StorageFactory.getGetter(myslot)();\n\t\t}\n\n\t\tfunction changeAttr(index)\n\t\t{\n\t\t\tvm3.selectedItem.attrs[vm3.selectedItem.properties[index][0]] = new Array(vm3.selectedItem.properties[index][2]);\n\t\t}\n\n\t\tfunction addProperty(string)\n\t\t{\n\t\t\tswitch(string)\n\t\t\t{\n\t\t\t\tcase 'add':\n\t\t\t\t{\n\t\t\t\t\tvm3.newProperty = {propname:\"new_property\",propdes:\"replace with your description\",propdef:\"\"};\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'cancel':\n\t\t\t\t{\n\t\t\t\t\tvm3.newProperty = null;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 'confirm':\n\t\t\t\t{\n\t\t\t\t\tif(vm3.newProperty.propname === \"\" || vm3.newProperty.propdes === \"\")\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tvm3.selectedItem.attrs[vm3.newProperty.propname] = new Array(vm3.newProperty.propdef);\n\t\t\t\t\tvm3.selectedItem.properties.unshift(new Array(vm3.newProperty.propname,vm3.newProperty.propdes,vm3.newProperty.propdef));\n\t\t\t\t\tvm3.newProperty = null;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction toggleSpinner()\n\t\t{\n\t\t\tvm3.showSpinner = !vm3.showSpinner;\n\t\t}\n\n\t\tfunction deleteProperty(index)\n\t\t{\n\t\t\tconsole.log(\"deleting property\", index, vm3.selectedItem.properties[index][0]);\n\t\t\tdelete vm3.selectedItem.attrs[vm3.selectedItem.properties[index][0]];\n\t\t\tvm3.selectedItem.properties.splice(index,1);\n\t\t}\n\n\t\tfunction showModel()\n\t\t{\n\n\t\t\t//vm3.displayItem = JSON.stringify(vm3.selectedItem,['properties'],4);\n\t\t\t//console.log(vm.displayItem);\n\t\t\tvar modalInstance = $uibModal.open(\n\t\t\t{\n\t\t\t\ttemplateUrl : \"./views/itemcontents.html\",\n\t\t\t\tcontroller : \"ModalController as vm5\",\n\t\t\t\twindowClass : \"mymodal\",\n\t\t\t\tresolve : {items : function ()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn vm3.selectedItem;\n\t\t\t\t\t}}\n\t\t\t});\n\t\t}\n\n\t\tfunction postDatamonster()\n\t\t{\n\t\t\tconsole.log(vm3.selectedItem);\n\t\t\ttoggleSpinner();\n\t\t\tModeratorFactory.postDatamonster(vm3.dataModel).then(function success(res)\n\t\t\t{\n\t\t\t\ttoggleSpinner();\n\t\t\t\tconsole.log(\"success\",res);\n\t\t\t}, \n\t\t\tfunction fail(err)\n\t\t\t{\n\t\t\t\ttoggleSpinner();\n\t\t\t\tconsole.log(\"fail\",err);\n\t\t\t});\n\t\t}\n\n\t\tfunction confirmDelete()\n\t\t{\n\n\t\t\tvar modalInstance = $uibModal.open(\n\t\t\t{\n\t\t\t\ttemplateUrl : \"./views/modal_delete_item.html\",\n\t\t\t\tanimation : true,\n\t\t\t\tcontroller : \"Modal2Controller as vm6\",\n\t\t\t\tsize : \"sm\",\n\t\t\t\tbackdrop : \"static\",\n\t\t\t\tresolve : \n\t\t\t\t{\n\t\t\t\t\titem : function ()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn vm3.selectedItem;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).result.then(function(result)\n\t\t\t{\n\t\t\t\tconsole.log(\"result:\", result);\n\t\t\t\tif(result === 'delete')\n\t\t\t\t{\n\t\t\t\t\ttoggleSpinner();\n\t\t\t\t\tModeratorFactory.deleteItem(vm3.selectedItem.classname).then(function succcess(res)\n\t\t\t\t\t{\n\t\t\t\t\t\ttoggleSpinner();\n\t\t\t\t\t\tconsole.log(\"response from service: \", res);\n\t\t\t\t\t\tvar parking = vm3.selectedItem.classname;\n\t\t\t\t\t\tdelete vm3.dataModel[parking];\n\t\t\t\t\t\tvm3.selectedItem = vm3.dataModel[Object.keys(vm3.dataModel)[0]];\n\t\t\t\t\t\tpostDatamonster();\n\t\t\t\t\t},\n\t\t\t\t\tfunction fail(err)\n\t\t\t\t\t{\n\t\t\t\t\t\ttoggleSpinner();\n\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t})\n\t\n\t.controller('ModalController', function($uibModalInstance, items)\n\t{\n\t\tvar vm5 = this;\n\t\tvm5.closeModal = closeModal;\n\t\tvm5.items = JSON.stringify(items,null, 4);\n\n\t\tfunction closeModal()\n\t\t{\n\t\t\t$uibModalInstance.close();\n\n\t\t}\n\t})\n\n\t.controller('Modal2Controller', function($uibModalInstance, item)\n\t{\n\t\tvar vm6 = this;\n\t\tvm6.closeModal = closeModal;\n\t\tvm6.deleteItem = deleteItem;\n\t\tvm6.item = item;\n\n\t\tfunction closeModal()\n\t\t{\n\t\t\t$uibModalInstance.close(\"cancel\");\n\t\t}\n\n\t\tfunction deleteItem()\n\t\t{\n\t\t\t$uibModalInstance.close(\"delete\");\n\t\t}\n\t});\n}());\n(function()\n{\n\t'use strict';\n\n\tvar app = angular.module('confab');\n\n\tapp.factory('ModeratorFactory', function($http, StorageFactory)\n\t{\n\tvar IAF_URL = StorageFactory.getGetter('IAF_URL')();\t\n\tvar availableLesson = null;\t\n\t\treturn{\n\t\t\tpostJsonBulk : postJsonBulk,\n\t\t\tpostDatamonster : postDatamonster,\n\t\t\tpostSchema : postSchema,\n\t\t\tdeleteItem : deleteItem,\n\t\t\tsetAvailableLesson : setAvailableLesson,\n\t\t\tgetAvailableLessons : getAvailableLessons\n\t\t};\n\n\t\tfunction setAvailableLesson(which)\n\t\t{\n\t\t\tavailableLesson = which;\n\t\t\tconsole.log(\"availableLesson\", availableLesson);\n\t\t}\n\n\t\tfunction getAvailableLessons()\n\t\t{\n\t\t\treturn availableLesson;\n\t\t}\n\n\t\tfunction postJsonBulk(json)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\t$http.post(API_URL + '/postJsonBulk', json).then(function success(resp)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.log(\"success\",resp);\n\t\t\t\t\t},\n\t\t\t\t\tfunction failure(err)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.log(\"failure\",err);\n\t\t\t\t\t});\n\t\t\t}\n\t\t\tcatch(err)\n\t\t\t{\n\t\t\t\talert (\"improper json\\n\",err);\n\t\t\t}\n\t\t}\n\n\n\t\t\n\n        \n        function convertXml(thexml)\n        {\n          \t//console.log(\"slot to convert to json:\", StorageFactory.getGetter(slot)());\n         \treturn $http({method:\"POST\",url: IAF_URL + '/convertToJson',data: thexml ,headers:{\"Content-Type\":'application/xml'} }).then(function(data)\n\t        {\n\t          return data;\n\t        },function(error)\n\t        {\n\t          console.log(\"error loading xml\", error);\n\t        });\n        }\n\n\n\t\tfunction postSchema()\n\t\t{\n\t\t\t\n\t\t}\n\n\t\tfunction postDatamonster(datamonster, thetag)\n        {\n          console.log(\"posting a monster with length \", Object.keys(datamonster).length);\n          \n          \t  //var helper = JSON.stringify(datamonster);\n          \t  return  $http({method:\"POST\",url:IAF_URL +'/api/storejson',data:datamonster,headers:{'content-type':'application/json'}}).then(function success(resp)\n\t          {\n\t            console.log(\"saving result\", resp.status);\n\t            postTag(thetag);\n\t          },\n\t          function failure(err)\n\t          {\n\t            console.log(\"failed result posting datamonster\", err.status);\n\t          });\n        }\n\n        function postTag(tag)\n        {\n        \treturn  $http.post(IAF_URL +'/api/postiaftag', tag).then(function success(resp)\n\t          {\n\t            console.log(\"saving a tag\", resp.status);\n\t          },\n\t          function failure(err)\n\t          {\n\t            console.log(\"failed result posting tag\", err.status);\n\t          });\n        }\n\n\t\t//TODO delete item directly in mongodb\n\t\tfunction deleteItem(classname)\n\t\t{\n\t\t\treturn $http({method:\"GET\", url: IAF_URL + '/api/deleteiaftag/' + classname }).then(\n\t\t\t\tfunction success(res)\n\t\t\t\t{\n\t\t\t\t\treturn res;\n\t\t\t\t}, \n\t\t\t\tfunction failure(err)\n\t\t\t\t{\n\t\t\t\t\treturn err;\n\t\t\t\t});\n\t\t}\n\n\t});\n}());\n(function(){\n\n'use strict';\n    var app = angular.module('confab');\n    app.constant('PROJECTNAME','Ibis4Student');\n    app.constant('API_URL', \"http://localhost:3000\");\n\n\n    app.constant('DOWNLOAD_URL',\"/iaf/api/configurations/download/Ibis4Student\");\n    app.constant('UPLOAD_URL',\"/iaf/api/configurations\");\n    // app.constant('IAF_URL', \"http://ibis4education-env.bz46fawhzf.eu-central-1.elasticbeanstalk.com\");\n\n    // app.constant('DOWNLOAD_URL',\"http://localhost:8080/Ibis4Education/iaf/api/configurations/download/Ibis4Student\");\n    // app.constant('UPLOAD_URL',\"http://localhost:8080/Ibis4Education/iaf/api/configurations\");\n    // app.constant('IAF_URL', \"http://localhost:8080/Ibis4Education/api\");\n    \n    //app.constant('DOWNLOAD_URL',\"http://localhost:8080/Ibis4Education/api/configurations/download/Ibis4Education/\");\n    //http://ibis4education-env.bz46fawhzf.eu-central-1.elasticbeanstalk.com/iaf/api/configurations\n\n\n    app.factory('StaticDataFactory', function(xmlTag, $http, StorageFactory, $interval) \n\n    {\n\n        var datasource = 'pipes';\n        var timerId = 0 ;\n        var themes = [\"twilight\", \"monokai\", \"neat\"];\n        var fontSizes = [12,13,14,15,16,17,18,19,20];\n        var thejson = null;\n        var selectedItem = null;\n        var IAF_URL = StorageFactory.getGetter('IAF_URL')();\n\n        var formattingSettings = {\n                \"indent_size\": 4,\n                \"xml\": {\n                    \"end_with_newline\": true,\n                    \"js\": {\n                        \"indent_size\": 2\n                    },\n                    \"css\": {\n                        \"indent_size\": 2\n                    }\n                },\n                \"css\": {\n                    \"indent_size\": 1\n                },\n                \"js\": {\n                 \"preserve-newlines\": true\n                }\n                };\n\n        return{\n            getJson : getJson,\n            getStaticJson : getStaticJson,\n            // loadXml : loadXml,\n            setDataSource: setDataSource,\n            getDataSource: getDataSource,\n            getFormattingSettings: getFormattingSettings,\n            getThemes: getThemes,\n            getFontSizes: getFontSizes,\n            setTimerId : setTimerId,\n            getTimerId : getTimerId,\n            stopTimer : stopTimer,\n            setSelectedItem : setSelectedItem,\n            getSelectedItem : getSelectedItem,\n            setIafUrl : setIafUrl\n\n        };\n\n        function setIafUrl()\n        {\n          IAF_URL = StorageFactory.getGetter(\"IAF_URL\")();\n        }\n\n        function setSelectedItem(item)\n        {\n          selectedItem = item;\n        }\n\n         function getSelectedItem()\n        {\n          return selectedItem;\n        }\n\n        function setTimerId(timerid)\n        {\n          timerId = timerid;\n        }\n\n        function getTimerId(timerid)\n        {\n          return timerId;\n        }\n\n\n        function stopTimer()\n        {\n          console.log(\"stopping timer...\");\n          $interval.cancel(timerId);\n          timerId = 0 ; \n        }\n\n        function getThemes()\n        {\n          return themes;\n        }\n\n        function getFontSizes()\n        {\n          return fontSizes;\n        }\n\n        function getFormattingSettings()\n        {\n          return formattingSettings;\n        }\n\n\n        function setDataSource(string)\n        {\n          datasource = string;\n        }\n\n        function getDataSource()\n        {\n          return datasource;\n        }\n\n\n                /* data is available directly in the response\n          */\n        function getJson()\n        { \n\n          return $http.get(IAF_URL + '/api/getjson').then(\n          function success(data)\n          {\n              console.info(\"returning json from server with status \",data.status);\n              thejson = data.data.JSONMONSTER.MYMONSTER;\n              return data;\n          },\n          function fail(err)\n          {\n            console.log(\"server error :\", err );\n          });\n\n        }  \n\n        //returns the datamodel for the moderatorController\n        function getStaticJson()\n        {\n          return thejson;\n        }\n\n        \n\n        // function loadXml(which)\n        // {\n        //   console.log(\"file to catch:\", which);\n        //   return $http.get(API_URL + '/snippets?resource=' + which ).then(function(data)\n        //     {\n        //       return data;\n        //     },function(error)\n        //     {\n        //       console.log(\"error loading xml\", error);\n        //     });\n        // }\n\n    });\n\n     app.factory('ZipService', function (StorageFactory, $http ,DOWNLOAD_URL, UPLOAD_URL, PROJECTNAME)\n     {\n        var myslots;\n        var IAF_URL = StorageFactory.getGetter('IAF_URL')();\n        return {\n            init : init,\n            getSlots : getSlots,\n            getZip : getZip,\n            getZipFromFile : getZipFromFile,\n            sendZip : sendZip,\n            getMySlots : getMySlots,\n            setIafUrl : setIafUrl\n        };\n\n        function setIafUrl()\n        {\n          IAF_URL = StorageFactory.getGetter('IAF_URL')();\n        }\n\n        function init()\n        {\n            return StorageFactory.getGetter(\"thejson\")();\n        }\n\n        function getSlots()\n        {\n            return StorageFactory.getGetter(\"myslots\")();\n        } \n\n        function getMySlots()\n        {\n            return myslots;\n        } \n\n        function sendZip(saveas)\n        {\n                return new Promise(function(resolve, reject)\n                {\n                var zip = new JSZip();\n                var elements = document.querySelectorAll('[ui-tree-node]');\n                //each tree element gets a filename and we grab the content from storage\n\n\n                elements.forEach(function(item)\n                {\n                    var object = angular.element(item).scope();\n                    var parents = [];\n\n                    while(object.$parentNodeScope !== null)\n                    {\n                        parents.push(object.$parentNodeScope.$modelValue.title);\n                        object = object.$parentNodeScope;\n                    }\n                    //console.log(\"parents of...\", object.$modelValue.title,\"\\n\",parents);       \n\n                    var filename = \"\";\n                    while(parents.length > 0)\n                    {   \n                        filename += cropFilter(parents.pop()) + '/';\n                        // console.log(\"filename: \", filename, \"\\n\");\n                    }\n                    \n\n                    // Het framework wil een configuration file perse met rootfolder hebben, zodoende dit onlogische stukje.\n                    //\"Ibis4Student/\" +\n                    if(cropFilter(angular.element(item).scope().$modelValue.title) === 'Configuration.xml')\n                    {\n                      \n                      filename = \"Ibis4Student/Configuration.xml\";\n                    }\n                    else\n                    {\n                      \n                      filename =  filename + cropFilter(angular.element(item).scope().$modelValue.title) ;\n                    }\n                    // console.log(\"filename finally: \", filename, \"\\n\\n\");\n\n                    if(angular.element(item).scope().$modelValue.isDirectory)\n                    {\n                        // console.log(\"adding directory\", angular.element(item).scope().$modelValue);\n                        zip.folder(filename);\n                    }\n                    else\n                    {   \n                        var theslot = StorageFactory.getGetter(angular.element(item).scope().$modelValue.title)();\n                        zip.file(filename,StorageFactory.getGetter(theslot)());\n                    }\n                });\n                var timestamp = Date.now();\n                var text = \"configuration.version=\" + timestamp;\n                zip.file(\"BuildInfo_SC.properties\" , text);\n\n                console.log(\"Zipfile \", zip);\n                //takes a path pattern and returns the last part: \"dir1/subdir2/myfile.txt\" => \"myfile.txt\"\n               \n               \n                function cropFilter(item)\n                {\n                    if(item === undefined) return \"\";\n                    var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\n                    if(helper.length > 0)\n                    {\n                        return helper;\n                    }\n                    else\n                    {\n                        return item;\n                    }\n                }\n\n                if(saveas)//responding to the save button in the treeview using file-saver API\n                {\n                  console.log(\"saving as a zip file...\");\n                  zip.generateAsync({type:\"blob\"}).then(function(myzip)\n                  {\n                    var blob = new Blob([myzip],{type:\"application/zip\"});\n                    console.log(\"generated a zip...\", blob);\n                    saveAs(blob, \"configuration.zip\");\n                    resolve();\n                  });\n                }\n                else //sending zip file to IAF\n                {\n                  postConfig(zip, timestamp).then(function success(resp)\n                  {\n                    console.log(\"returning from postconfig\");\n                    resolve(resp);\n                  },function failure(err)\n                  {\n                    console.log(\"returning error from postconfig\");\n                    reject(err);\n                  });\n                }\n                });\n        }\n\n\n        function postConfig(zip, timestamp)\n        {\n          return new Promise(function(resolve, reject)\n          {\n            if(IAF_URL === undefined || typeof IAF_URL !== 'string')\n            {\n              alert(\"please add a correct IAF url\");\n              return 'error';\n            }\n\n            var finalurl = IAF_URL + UPLOAD_URL;\n            alert(finalurl);            \n\n            zip.generateAsync({type:\"blob\"}).then(function(myzip)\n            {\n              var fileName = 'configuration.zip';\n              var fd = new FormData();\n              \n\n              fd.append(\"realm\", 'jdbc');\n              fd.append(\"name\", \"Ibis4Student\");\n              fd.append(\"version\", timestamp);\n              fd.append(\"encoding\", 'utf-8');\n              fd.append(\"multiple_configs\", false);\n              fd.append(\"activate_config\", true);\n              fd.append(\"automatic_reload\", true);\n              fd.append(\"file\", myzip, fileName);\n\n              console.log(\"posting to iaf\", myzip);\n              $http({method: 'POST',url:finalurl , data: fd , headers:{'Content-type': undefined}})\n              .then(function succes(response)\n              {\n                  console.info(\"returning from backend\",response);\n                  resolve (response);\n              }, function failure(err)\n              {\n                  console.info(\"returning error from backend\",err);\n                  reject(err);\n              });\n\n              });//end of JSZIP promise\n\n            });//end of new promise\n\n        }\n\n\n        function getZipFromFile(file)\n        {\n          return JSZip.loadAsync(file).then(function(zip)\n            {\n              console.log(\"loadasync from file...\", zip);\n              StorageFactory.deleteAll();\n              var myzipfiles = [];\n              \n              //removing unwanted entries\n              zip.forEach(function(relativePath, file)\n              {\n                if(file.name.substring(0,2) !== '__' && file.name !== PROJECTNAME +'/' && file.name !== 'BuildInfo_SC.properties')\n                {\n                  myzipfiles.push(file);\n                }\n              });\n              \n              //removing an unwanted wrapper directory ('Ibis4Student/Configuration.xml becomes 'Configuration.xml')\n              for(var i=0 ; i< myzipfiles.length; i++)\n              {\n                if(myzipfiles[i].name.indexOf(PROJECTNAME) > -1)\n                      {\n                        console.log(\"slicing out\", myzipfiles[i].name);\n                        var item = myzipfiles[i].name;\n                        var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\n                        myzipfiles[i].name = helper;\n                      }\n              }\n\n\n\n\n              /*Write to local storage; to avoid collisions, the calls\n              are made synchronously.*/\n              storeZip(0);\n              \n              function storeZip(index)\n              {\n                if(index > myzipfiles.length-1)\n                {\n                  return;\n                }\n                else\n                {\n                  if(!(myzipfiles[index].dir))\n                  {\n                    myzipfiles[index].async(\"string\").then(function resolve(data)\n                    {\n                        var newslotname = \"slot\" + Math.ceil(Math.random()*1000);\n                        StorageFactory.getSetter(myzipfiles[index].name)(newslotname);\n                        StorageFactory.getSetter(newslotname)(data);\n                        index++;\n                        storeZip(index++);\n                    });\n                  }\n                  else\n                  {\n                    index++;\n                    storeZip(index);\n                  }\n                }\n              }                              \n\n              console.log(\"zipfiles\",myzipfiles);\n              var myjson=[];\n              myslots = {};\n\n              //creation of a flat json structure              \n              for(var i =0 ; i< myzipfiles.length ; i++)\n              {\n                if(myzipfiles[i].dir)\n                {\n                    myjson.push({\n                    id : Math.ceil(Math.random() * 10000),  \n                    isDirectory : myzipfiles[i].dir,\n                    title : myzipfiles[i].name.substring(0,myzipfiles[i].name.length-1),\n                    nodes : []\n                    });\n                }\n                else\n                {\n                  var myobj = {\n                    id : Math.ceil(Math.random() * 10000),\n                    isDirectory : myzipfiles[i].dir,\n                    title : myzipfiles[i].name,\n                    nodes : []\n                    };\n                  myjson.push(myobj);\n                  myslots[myobj.id] = {title:myobj.title, isLocked:false};\n                }\n              }\n\n              //sorting the array: highest amount of nodes first .\n              myjson.sort(function compare(val1, val2)\n              {\n                if(val1.title.split('/').length > val2.title.split('/').length)\n                {\n                  return -1;\n                }\n                if(val1.title.split('/').length < val2.title.split('/').length)\n                {\n                  return 1;\n                }\n                return 0;\n              });\n\n                var helper = 0;//emergency variable to prevent a possible eternal loop\n                var parentsfound = true; //escapes the while loop when we had a run with no results\n\n                \n                /*\n                adding children to the parents node arrays; when there is a parent found myjson is changed\n                and we will start the loop again\n                */\n                while(parentsfound &&  helper <100)\n                {\n                  parentsfound = false;\n                  var copy = myjson;\n\n                  for(var index = 0 ; index < myjson.length; index ++)\n                  {\n                    for(var j=0 ; j< copy.length; j++)\n                    {\n                      if(isParent(myjson[index].title, copy[j].title))\n                      {\n                        // console.log(myjson[index].title, \"direct parent of \" ,copy[j].title);\n                        // console.log(\"myjson\",myjson);\n                        myjson[index].nodes.push(copy[j]);\n                        myjson.splice(j,1);\n                        parentsfound = true;\n                        break;\n                      }\n                    }\n                    if(parentsfound)\n                    {\n                      break;\n                    }\n                  }\n                  helper ++;\n                }\n               \n\n\n                /* Main helper function of the recursive loop; \"dir1/dir2/file1.abc\" compared with \"dir1/dir2\" will\n                regard this as a direct parent-child relationship. */ \n                function isParent(possibleparent, candidate)\n                {\n                  if(possibleparent === candidate)\n                  {\n                    return false;\n                  }\n                  var index = candidate.lastIndexOf('/');\n                  if(candidate.substring(0,index) === possibleparent)\n                  {\n                    return true;\n                  }\n                  else\n                  {\n                    return false;\n                  }\n                }\n\n                console.log(\"generated json out of zip:\\n\",myjson);\n\n                //saving json and working files structure to local storage, and returning to the caller\n                StorageFactory.getSetter('thejson')(myjson);\n                StorageFactory.getSetter('myslots')(myslots);  \n                return(myjson); \n\n              });//end of jszip async call\n        }\n\n\n\n\n\n\n        /*\n          retrieves IAF configuration zip file via http, and transforms this zipfile  to a json object\n          the zipfiles data are stored in LocalStorage;\n        */\n        function getZip()\n        {\n          var finalUrl = IAF_URL + DOWNLOAD_URL;\n          console.log(\"Download url :\",finalUrl);\n\n          return $http({method:\"GET\", url: finalUrl, responseType:'arraybuffer'}).then(function success(resp)\n          {\n            return new Promise(function (resolve, reject)\n            {\n            JSZip.loadAsync(resp.data).then(function(zip)\n            {\n              console.log(\"loadasync...\", zip);\n              StorageFactory.deleteAll();\n              var myzipfiles = [];\n              \n              //removing the mac specific entries...don't know whether this is the proper way...\n              zip.forEach(function(relativePath, file)\n              {\n                if(file.name.substring(0,2) !== '__' && file.name !== PROJECTNAME +'/' && file.name !== 'BuildInfo_SC.properties')\n                {\n                  myzipfiles.push(file);\n                }\n              });\n\n              //removing an unwanted wrapper directory ('Ibis4Student/Configuration.xml becomes 'Configuration.xml')\n              for(var i=0 ; i< myzipfiles.length; i++)\n              {\n                if(myzipfiles[i].name.indexOf(PROJECTNAME) > -1)\n                      {\n                        console.log(\"slicing out\", myzipfiles[i].name);\n                        var item = myzipfiles[i].name;\n                        var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\n                        myzipfiles[i].name = helper;\n                      }\n              }\n\n\n    \n              /*Write to local storage; to avoid collisions, the calls\n              are made synchronously.*/\n              storeZip(0);\n              \n              function storeZip(index)\n              {\n                if(index > myzipfiles.length-1)\n                {\n                  return;\n                }\n                else\n                {\n                  if(!(myzipfiles[index].dir))\n                  {\n                    myzipfiles[index].async(\"string\").then(function resolve(data)\n                    {\n                        var newslotname = \"slot\" + Math.ceil(Math.random()*1000);\n                        StorageFactory.getSetter(myzipfiles[index].name)(newslotname);\n                        StorageFactory.getSetter(newslotname)(data);\n                        index++;\n                        storeZip(index++);\n                    });\n                  }\n                  else\n                  {\n                    index++;\n                    storeZip(index);\n                  }\n                }\n              }                              \n\n              console.log(\"zipfiles\",myzipfiles);\n              var myjson=[];\n              myslots = {};\n\n              //creation of a flat json structure              \n              for(var i =0 ; i< myzipfiles.length ; i++)\n              {\n                if(myzipfiles[i].dir)\n                {\n                    myjson.push({\n                    id : Math.ceil(Math.random() * 10000),  \n                    isDirectory : myzipfiles[i].dir,\n                    title : myzipfiles[i].name.substring(0,myzipfiles[i].name.length-1),\n                    nodes : []\n                    });\n                }\n                else\n                {\n                  var myobj = {\n                    id : Math.ceil(Math.random() * 10000),\n                    isDirectory : myzipfiles[i].dir,\n                    title : myzipfiles[i].name,\n                    nodes : []\n                    };\n                  myjson.push(myobj);\n                  myslots[myobj.id] = {title:myobj.title, isLocked:false};\n                }\n              }\n\n              //sorting the array: highest amount of nodes first .\n              myjson.sort(function compare(val1, val2)\n              {\n                if(val1.title.split('/').length > val2.title.split('/').length)\n                {\n                  return -1;\n                }\n                if(val1.title.split('/').length < val2.title.split('/').length)\n                {\n                  return 1;\n                }\n                return 0;\n              });\n\n                var helper = 0;//emergency variable to prevent a possible eternal loop\n                var parentsfound = true; //escapes the while loop when we had a run with no results\n\n                \n                /*\n                adding children to the parents node arrays; when there is a parent found myjson is changed\n                and we will start the loop again\n                */\n                while(parentsfound &&  helper <100)\n                {\n                  parentsfound = false;\n                  var copy = myjson;\n\n                  for(var index = 0 ; index < myjson.length; index ++)\n                  {\n                    for(var j=0 ; j< copy.length; j++)\n                    {\n                      if(isParent(myjson[index].title, copy[j].title))\n                      {\n                        // console.log(myjson[index].title, \"direct parent of \" ,copy[j].title);\n                        // console.log(\"myjson\",myjson);\n                        myjson[index].nodes.push(copy[j]);\n                        myjson.splice(j,1);\n                        parentsfound = true;\n                        break;\n                      }\n                    }\n                    if(parentsfound)\n                    {\n                      break;\n                    }\n                  }\n                  helper ++;\n                }\n               \n\n\n                /* Main helper function of the recursive loop; \"dir1/dir2/file1.abc\" compared with \"dir1/dir2\" will\n                regard this as a direct parent-child relationship. */ \n                function isParent(possibleparent, candidate)\n                {\n                  if(possibleparent === candidate)\n                  {\n                    return false;\n                  }\n                  var index = candidate.lastIndexOf('/');\n                  if(candidate.substring(0,index) === possibleparent)\n                  {\n                    return true;\n                  }\n                  else\n                  {\n                    return false;\n                  }\n                }\n\n                console.log(\"generated json out of zip:\\n\",myjson);\n\n                //saving json and working files structure to local storage, and returning to the caller\n                StorageFactory.setCurrentKey(myslots[0]);\n                StorageFactory.getSetter('thejson')(myjson);\n                StorageFactory.getSetter('myslots')(myslots);  \n                resolve(myjson); \n\n              }, \n              function failure(err)\n              {\n                console.log(\"error\", err);\n                reject(err);\n              });//end of jszip async call\n\n            });//end of Promise (necessary because of nested promises...)\n\n        },\n        function failure(err)\n        {\n          console.log(\"error in http call\", err);\n          return;\n        },function failure(err)\n        {\n          console.log(\"error in http call\", err);\n          return;\n        });//end of http);//end of http\n\n      }//end of method getzip\n\n     });//end of factory\n\n\n\n\n    /*\n    facilitates local storage; we can store and retrieve values: storing : StorageFactory.getSetter(key)(value)\n    retrieving : StorageFactory.getGetter(key)() ; removing a key : StorageFactory.getSetter(key)()\n    */\n    app.factory('StorageFactory',['storage', '$log', function(storage, $log)\n    {\n      var api = {};\n      var thekeys;\n      var thealiases = [\"file1\"];\n      var currentKey = \"slot1\";\n      var myaliases;\n      \n      return {\n        getSetter : getSetter,\n        getGetter : getGetter,\n        verifyKey : verifyKey,\n        createAPIForKey : createAPIForKey,\n        createSetter : createSetter,\n        createGetter : createGetter,\n        getAliases : getAliases,\n        switchKey : switchKey,\n        setCurrentKey : setCurrentKey,\n        getCurrentKey : getCurrentKey,\n        getNewSlotname : getNewSlotname,\n        initialise : initialise,\n        deleteAll : deleteAll,\n        changeKeys : changeKeys\n      };\n\n      function initialise()\n      {\n\n        if(storage.getKeys().indexOf(\"ngIdle.expiry\") > -1)\n        {\n            getSetter(\"ngIdle.expiry\")();\n        }  \n\n\n        if(storage.getKeys().length === 0 || storage.getKeys().length === 1 && getGetter('IAF_URL')() !== null)\n        {\n          console.log(\"adding files...\");\n          getSetter(\"slot1\")(\" start here...\");\n          getSetter(\"file1\")(\"slot1\");\n          var thejson = [\n                          {\n                            \"id\": 1,\n                            \"title\": \"dir1\",\n                            \"isDirectory\": true,\n                            \"nodes\": [\n                              {\n                                \"id\": 2,\n                                \"title\": \"file1\",\n                                \"isDirectory\": false,\n                                \"isLocked\": false,\n                                \"nodes\": []\n                              }\n                            ]\n                          }\n                        ];\n          var myslots = { 2 : {\"title\":\"file1\",isLocked:false} };              \n          getSetter(\"thejson\")(thejson);//setting file structure in localstorage; w\n          getSetter(\"myslots\")(myslots);//setting the open files configuration\n          thekeys = createKeys([\"file1\"]);\n        }\n        else\n        {\n          console.log(\"adding from local storage contents.\");\n          var helper = storage.getKeys();\n\n          if(helper.indexOf(\"thejson\") > -1)\n          {\n              helper.splice(helper.indexOf(\"thejson\"),1);\n          }  \n          if(helper.indexOf(\"myslots\") > -1)\n          {\n              helper.splice(helper.indexOf(\"myslots\"),1);\n          } \n          if(helper.indexOf(\"IAF_URL\") > -1)\n          {\n              helper.splice(helper.indexOf(\"IAF_URL\"),1);\n          }\n\n          thekeys = createKeys(helper); \n          console.log(\"created keys:\", thekeys);\n        }\n        currentKey = thekeys[0];\n      }\n\n      function changeKeys(oldname, newname)\n      {\n        console.log(oldname , newname,\"\\n\", thekeys, currentKey, \"\\n\");\n        var index = -1;\n        var islocked = \"\";\n        for(var i= 0 ; i< thekeys.length ; i++)\n        {\n          if(thekeys[i].title === oldname)\n          {\n            index = i;\n            islocked = thekeys[i].isLocked;\n          }\n        }\n        if(index !== -1)\n        {\n          if(currentKey.title === oldname)\n          {\n            currentKey.title = newname;\n          }\n          thekeys[index].title = newname;\n        }\n        console.log(\"after change: \", thekeys,\"\\n\", currentKey, \"\\n\");\n      }\n\n      function deleteAll()\n      {\n        var keys = storage.getKeys();\n        keys.forEach(function(key)\n        {\n          if(key !== 'IAF_URL')\n          {\n            getSetter(key)();\n          }\n        });\n      }\n\n      function switchKey()\n      {\n          var helper = thekeys.shift();\n          thekeys.push(helper);\n          currentKey = thekeys[0];\n          return thekeys[0];\n      }\n\n      //remove from keys array\n      function removeKey(itsAlias)\n      {\n        var index;\n        for(var i =0 ; i< thekeys.length; i++)\n        {\n          if(thekeys[i].title === itsAlias)\n          {\n              index = i;\n          }\n        }\n        thekeys.splice(index, 1);\n\n        if(currentKey.title === itsAlias)//check if the file we're working on is deleted\n        {\n          currentKey = thekeys[0];\n        }\n      }\n\n\n\n\n      //responding to the add new button in the file browser\n      function getNewSlotname(createdAlias, theid)\n      {\n        console.log(\"id \", theid);\n        var newslotname = \"slot\" + Math.ceil(Math.random()*1000);\n        var theobject = { \"title\" : createdAlias, \"isLocked\" : false };\n        thekeys.push(theobject);\n        getSetter(newslotname)('<?xml version=\"1.0\" encoding=\"UTF-8\"?>');\n        getSetter(createdAlias)(newslotname);\n        var helper = getGetter(\"myslots\")();\n        helper[theid] = theobject;\n        getSetter(\"myslots\")(helper);\n        return newslotname;\n      }\n\n      \n\n\n      function getAliases()\n      {\n        var output = [];\n\n        thealiases.forEach(function(value)\n        {\n          output.push(getGetter(value)());\n        });\n\n      return output;  \n      }\n\n\n      //current key is an object { title:\"\", isLocked: bool }\n      function setCurrentKey(key)\n      {\n       console.log(\"set currentkey::\", key); \n        currentKey = key;\n      }\n\n      function getCurrentKey()\n      {\n        //console.log(\"currentkey::\", currentKey);\n        return currentKey;\n      }      \n\n\n      function createKeys(helper)\n      {\n        var result = [];\n        helper.forEach(function(val)\n        {\n          if(val.substring(0,4) !== 'slot' )\n          {\n            result.push({\"title\" : val, \"isLocked\" : false});\n          }\n        });\n        return result;\n      }\n\n      function getSetter(key)\n      {\n        verifyKey(key);\n        return api[key].setter;\n      }\n      function getGetter(key)\n      {\n        verifyKey(key);\n        return api[key].getter;\n      }\n\n      function verifyKey(key)\n      {\n        if(!key || angular.isUndefined(key))\n        {\n          throw new Error(\"Key[ \" + key + \" ] is invalid\");\n        }\n\n        if(!api.hasOwnProperty(key))\n        {\n          createAPIForKey(key);\n        }\n\n\n      }\n\n      function createAPIForKey(key)\n      {\n        var setter = createSetter(key);\n        var getter = createGetter(key);\n        api[key] = \n        {\n          setter : setter,\n          getter : getter\n        };\n      }\n\n      function createSetter(key)\n      {\n        return function(value)\n        {\n          if(angular.isDefined(value))\n          {\n            try\n            {\n              storage.set(key, value);\n            }\n            catch(error)\n            {\n              $log.info('[StorageFactory]' + error.message);\n            }\n          }\n          else\n          {\n            storage.remove(key);\n          }\n        };\n      }\n\n      function createGetter(key)\n      {\n        return function()\n        {\n          var value = storage.get(key);\n          if(value === null)\n          {\n            value = undefined;\n            var setter = api[key].setter;\n            setter(value);\n          }\n          return value;\n        };\n      }\n    }]);\n    app.factory('EditorFactory', function()\n    {\n    var editor = null;  \n      \n      return {\n        editorLoaded : editorLoaded\n      };\n\n      function editorLoaded(_editor)\n      {\n                var _doc = _editor.getDoc();\n                _editor.focus();\n                _editor.setOption('lineNumbers', true);\n                _editor.setOption('lineWrapping', true);\n                _editor.setOption('mode', 'xml');\n                _editor.setOption('beautify', 'true');\n                _editor.setOption('theme', 'twilight');\n                _editor.setOption('foldGutter', true);\n                _editor.setOption('gutters',[ \"CodeMirror-linenumbers\",\"CodeMirror-foldgutter\"]);\n                _editor.setOption('matchTags', {bothTags: true});\n                var extraKeys =  {\n                          \"'<'\": completeAfter,\n                          \"'/'\": completeIfAfterLt,\n                          \"' '\": completeIfInTag,\n                          \"'='\": completeIfInTag,\n                          \"Ctrl-Space\": \"autocomplete\"\n                                };\n                _editor.setOption('extraKeys', extraKeys);\n\n                console.log(\"editor loaded;\",_editor.options);\n\n                var windowheight = window.innerHeight;\n                var navbarheight = document.getElementById('mynavbar').offsetHeight;\n                var ed = document.querySelector('.CodeMirror');\n                ed.style.height = (windowheight - navbarheight) + 'px'; \n                console.log(\"window, navbar, editor:\", windowheight, navbarheight, ed.style.height);\n\n                function completeAfter(cm, pred) \n                {\n                    var cur = cm.getCursor();\n                    if (!pred || pred()) setTimeout(function() \n                    {\n                        if (!cm.state.completionActive)\n                        cm.showHint({completeSingle: false});\n                    }, 100);\n                    return CodeMirror.Pass;\n                }\n\n                function completeIfAfterLt(cm) \n                {\n                    return completeAfter(cm, function() \n                    {\n                        var cur = cm.getCursor();\n                        return cm.getRange(CodeMirror.Pos(cur.line, cur.ch - 1), cur) == \"<\";\n                    });\n                }\n\n                function completeIfInTag(cm) \n                {\n                return completeAfter(cm, function() \n                {\n                    var tok = cm.getTokenAt(cm.getCursor());\n                    if (tok.type == \"string\" && (!/['\"]/.test(tok.string.charAt(tok.string.length - 1)) || tok.string.length == 1)) return false;\n                    var inner = CodeMirror.innerMode(cm.getMode(), tok.state).state;\n                    return inner.tagName;\n                });\n\n              }\n              return _editor;\n            }\n\n    });\n    app.factory('ValidationFactory', function(StorageFactory, $http )\n    {\n      return {\n        validateXml : validateXml\n      };\n\n      function validateXml()\n      {\n\n          // return $http.get(API_URL + '/validate').then(function succes(res)\n          // {\n          //   var thexml = StorageFactory.getGetter(StorageFactory.getCurrentKey())();\n          //   console.log(\"xsd:\\n\",  res);\n          //   console.log(\"xml:\\n\", typeof thexml);\n          //   var message = validateXML(thexml, res.data);\n          //   return message;\n          // },\n          // function fail(err)\n          // {\n          //   console.log(\"failure....\", err);\n          //   return err;\n          // });  \n      }\n    });\n    app.factory('IafFactory', function($http, StorageFactory, StaticDataFactory, ZipService, UPLOAD_URL)\n    {\n      \n    var uname = null;\n    var pw = null;\n    var IAF_URL = StorageFactory.getGetter('IAF_URL')();\n      return{\n        postConfig : postConfig,\n        setCredentials : setCredentials,\n      };\n\n      //resonding to the paperplane button upper right\n      function postConfig(zip)\n      {\n        return new Promise(function(resolve, reject)\n        {\n          var finalurl = IAF_URL + UPLOAD_URL;\n          alert(finalurl);\n        zip.generateAsync({type:\"blob\"}).then(function(myzip)\n        {\n          var fileName = 'configuration.zip';\n          var fd = new FormData();\n          fd.append(\"realm\", 'jdbc');\n          fd.append(\"name\", \"Ibis4Student\");\n          fd.append(\"version\", 1);\n          fd.append(\"encoding\", 'utf-8');\n          fd.append(\"multiple_configs\", false);\n          fd.append(\"activate_config\", true);\n          fd.append(\"automatic_reload\", true);\n          fd.append(\"file\", myzip, fileName);\n\n\n          return new Promise(function(resolve, reject)\n          {\n             console.log(\"posting to iaf\", myzip);\n              return $http({method: 'POST',url:finalurl , data: fd , headers:{'Content-type': undefined}}\n                  ).then(function succes(response)\n                  {\n                      console.info(\"returning from backend\",response);\n                      resolve (response);\n                  }, function failure(response)\n                  {\n                      console.info(\"returning error from backend\",response);\n                      reject(response);\n                  });\n                });           \n          });\n        resolve();\n        });\n\n\n\n      }\n\n      //responding to the submit button in the authentication area.\n      function setCredentials(server, uname, pw)\n      {\n        return new Promise(function(resolve, reject)\n        {\n          if (server)\n          {\n            if(server.indexOf('/#/')> -1)\n            {\n              server = server.substring(0,server.indexOf('/#/'));\n            }\n\n            if(server.charAt(server.length-1) === '/')\n            {\n              server = server.substring(0,server.length-1);\n            }\n\n\n            console.log(\"credentials: \" , server, uname, pw);\n            IAF_URL = server;\n            StorageFactory.getSetter('IAF_URL')(server);\n            StaticDataFactory.setIafUrl();\n            ZipService.setIafUrl();\n            if(StaticDataFactory.getStaticJson() === null || StaticDataFactory.getStaticJson() === undefined)\n            {\n              StaticDataFactory.getJson().then(function success(resp)\n              {\n                console.log(\"succes from factory... now updating the scope\");\n                resolve(resp);\n              },\n              function failure(err)\n              {\n                 console.log(\"failure getting json...\", err);\n                 reject(err);\n              });\n            }\n          }\n          else\n          {\n            console.log(\"doing noting...\");\n          }\n        });\n      }\n    });\n\n})();   \n(function ()\n{\n    'use strict';\n    /*TODO's : adding new directory / new file button*/\n    angular.module('confab')\n        .controller('ApsTreeController', function ($scope,$uibModal, ZipService, StorageFactory,StaticDataFactory, IafFactory,$timeout)\n        {\n\n            console.log('TreeController...');\n            var vm2 = this;\n            vm2.remove = remove;\n            vm2.toggle = toggle;\n            vm2.setSelectedSlot = setSelectedSlot;//is a number , the id of a node file object.\n            vm2.changeName = changeName;\n            vm2.newSubitem = newSubitem;\n            vm2.modifyAlias = modifyAlias;\n            vm2.getZip = getZip;\n            vm2.addFileOrFolder = addFileOrFolder;\n            vm2.saveToFile= saveToFile;\n            vm2.showZipDialog = showZipDialog;\n\n            //is called in home.html\n            vm2.treeOptions =\n            {\n                   \n            };\n\n            init();\n\n            function showZipDialog()\n            {\n\n                var modalInstance = $uibModal.open(\n                {\n                    templateUrl : \"./views/loadzipdialog.html\",\n                    controller : \"LoadZipController as vm3\",\n                    size : \"md\",\n                    resolve : {items : function ()\n                        {\n                            return \"something\";\n                        }}\n                });\n\n                \n                //sets a listener on the load from file button;\n                modalInstance.rendered.then(\n                function success(resp)\n                {\n                var zipfromfile = document.getElementById('zipfromfile');\n                console.log(zipfromfile);\n                zipfromfile.addEventListener('change', function(event)\n                {\n                    console.log(\"file chosen !\", event.target.files[0]);\n                    modalInstance.close({returntype:\"viafile\"});\n                    StaticDataFactory.stopTimer();\n                    ZipService.getZipFromFile(event.target.files[0]).then(function success(resp)\n                    {\n                        console.log(\"succes...\");\n                        vm2.list = resp;\n                        console.log(vm2.list);\n                        vm2.mySlots = ZipService.getMySlots();\n                        var keys = Object.keys(vm2.mySlots);\n                        StorageFactory.setCurrentKey(vm2.mySlots[keys[0]]);\n                        setSelectedSlot({id:keys[0]});\n\n                        //$scope.$emit('Keychange');                         \n\n                    },function failure(err)\n                    {\n                        console.log(\"failure...\", err);\n                    });\n\n                });    \n                },function failure(err)\n                {\n                    \n                });\n\n\n\n\n                modalInstance.result.then(function success(resp)\n                {\n                    console.log(\"response: \" , resp.returntype);\n                    if(resp.returntype === 'viahttp')\n                    {\n                        vm2.list = resp.data;\n                        vm2.mySlots = ZipService.getMySlots();\n                        var keys = Object.keys(vm2.mySlots);\n                        setSelectedSlot({id:keys[0]}) ;\n                        console.log(vm2.list);\n                    }\n\n                    },function failure(err)\n                    {\n                        console.log(\"no result from modal...\");\n                    });\n            }\n\n\n            function saveToFile()\n            {\n                ZipService.sendZip(true).then(function success(resp)\n                {\n                    alert(\"savedToFile!\");    \n                },\n                function failure(err)\n                {\n                    console.log(\"saving to file failed...\");\n                });\n            }\n\n            function addFileOrFolder(item)\n            {\n                var thetype = (item === 'file'? false : true);\n\n\n               var newobject = {\n                            id: Math.floor(Math.random()*10000) ,\n                            title: item + createRandomSuffix(),\n                            isDirectory : thetype,\n                            isLocked : false,\n                            nodes: []\n                            };\n               vm2.list.push(newobject);\n               if(item === 'file')\n               {\n                   StorageFactory.getNewSlotname(newobject.title, newobject.id);\n                   vm2.mySlots[newobject.id] = {\"title\" : newobject.title,\"isLocked\": false};\n                   setSelectedSlot(newobject);\n               }\n            }\n\n\n\n\n            function init()\n            {\n                vm2.list = StorageFactory.getGetter(\"thejson\")();\n                vm2.mySlots = StorageFactory.getGetter(\"myslots\")();\n            }\n\n\n\n            function getZip()\n            {\n                console.log(\"getzip...\");\n                ZipService.getZip().then(function success(data)\n                {\n                    console.log(\"data back\", data);\n                    vm2.list = data;\n                    vm2.mySlots = ZipService.getMySlots();\n                    var keys = Object.keys(vm2.mySlots);\n                    setSelectedSlot({id:keys[0]}) ;\n                    console.log(vm2.list);\n                    //$timeout(changeTheNames, 1000);//waiting for the scope to have settled;otherwise view is ok but scope not parallel\n                }, function fail(err)\n                {\n                    console.log(\"failure getting zip: \", err);\n                });\n            }\n\n            //listens to a button press on the key icon in the main controller and updates the model\n            $scope.$on('KeySwitch', function(event, key)\n            {\n                var thekeys = Object.keys(vm2.mySlots);\n                console.log(\"treecontro\", key, thekeys);\n                for(var i=0 ;i < thekeys.length; i++)\n                {\n                    // console.log(i , \" : \", vm2.mySlots[thekeys[i]]);\n\n                    if(vm2.mySlots[thekeys[i]].title == key.title)\n                    {\n                        console.log(\"bingo\",thekeys[i]);\n\n                        var helper = \n                        {\n                            id:thekeys[i],\n                            title:thekeys[i].title,\n                            isLocked:thekeys,\n                            nodes:[],\n                            isDirectory:false\n                        };\n\n                        setSelectedSlot(helper);\n                    }\n                }\n\n            });\n\n            $scope.$watch('vm2.selectedSlot', function()\n            {\n                console.log(\"selected slot changed: \", vm2.selectedSlot);\n            });\n\n            //Any change in the file tree is saved in localstorage to reload later\n            $scope.$watch('vm2.list', function()\n            {\n                console.log(\"updating local storage;\");\n                StorageFactory.getSetter(\"thejson\")(vm2.list);\n            }, true);\n\n            //responds to change of the slotname : internally the slotnames are slot1, slot2...etc,\n            //externally a user can choose any alias he wants.\n            function modifyAlias(slotn, newname)\n            {\n                console.log(\"modify \",slotn, newname);\n                StorageFactory.getSetter(slotn)(newname);\n            }\n\n\n\n            function setSelectedSlot(object)\n            {\n                    console.log(\"changing selected slot...\", object);\n                if(object.hasOwnProperty('id'))\n                {\n                    $scope.$emit('saveOldValues');\n                    vm2.selectedSlot = object.id;\n                    StorageFactory.setCurrentKey(vm2.mySlots[vm2.selectedSlot]);\n                    $scope.$emit('Keychange');\n                }\n                else\n                {\n                    if(!(object.isDirectory))\n                    {\n                        $scope.$emit('saveOldValues');\n                        //vm2.selectedSlot = object.id;\n                        vm2.selectedSlot = object.$modelValue.id;\n                        StorageFactory.setCurrentKey(vm2.mySlots[vm2.selectedSlot]);\n                        $scope.$emit('Keychange');\n                    }\n                }    \n                console.log(\"setting slot to \", vm2.selectedSlot);\n            }\n\n\n            /* Sets the name of the tree item contenteditable and places the caret; \n            On enter or on blur the nameGiver directive updates the model with the current viewvalue.\n            */\n            function changeName(item)\n            {\n                var element = document.getElementById('treeitem' + item.$modelValue.id);\n                element.setAttribute('contentEditable', true);\n                var textnode = element.firstChild;\n                var caret = textnode.length;\n                var range = document.createRange();\n                range.setStart(textnode, 0);\n                range.setEnd(textnode, caret);\n                var sel = window.getSelection();\n                sel.removeAllRanges();\n                sel.addRange(range);\n                console.log(\"element: \",element);\n                element.focus();\n            }\n\n\n            /*\n                Removes an item from the tree after checking if the user doesn't check the last item.\n                Also the corresponding slot must be deleted and the model updated accordingly.\n                object one level higher in the hierarchy: object.$parentNodeScope\n                siblings of the current object : object.$parentNodesScope.$modelValue   (note the small 's' difference)\n            */\n            function remove(object)\n            {\n                var theid = object.$modelValue.id;\n                var parking = getRoot(object);\n                var nodetype = object.$modelValue.isDirectory;\n                var counter = 0;\n\n                if(nodetype)//if it is a directory we want to remove\n                {\n                    var currentLayer = object;\n\n                    while(currentLayer !== null && counter < 10)\n                    {\n                          if(lookForDirectory(currentLayer.$parentNodesScope.$modelValue, object.$modelValue.id))\n                            {\n                                console.log(\"removable: \", object.$modelValue.title);\n                                var results = deleteContainingFiles(object);\n                                console.log(\"results: \",results );\n                                \n                                //checking for the case that no files are left after this deletion\n                                //updating the mySlots object with the current slots.\n                                if(results.length < Object.keys(vm2.mySlots).length)\n                                {   \n                                    results.forEach(function(item)\n                                    {\n                                        deleteFromLocalStorage(item);\n                                        delete vm2.mySlots[item];\n                                    });\n                                    object.remove();\n                                }\n                                break;\n                            }\n                          else\n                          {\n                            currentLayer = currentLayer.$parentNodeScope;\n                            console.log(\"watching layer above\" ,currentLayer );\n                          }    \n                          counter++;\n                    }\n                }\n                else//if it is a file we want to remove\n                {\n                    if(traverseArray(parking.$parentNodesScope.$modelValue, false))\n                    {\n                        console.log(\"removable: \", object.$modelValue.title);\n                        deleteFromLocalStorage(object.$modelValue.id);\n                        delete vm2.mySlots[object.$modelValue.id]; //remove from the slots\n                        object.remove(); //remove from the filetree\n                    }\n                }\n\n                function deleteFromLocalStorage(itsid)\n                {\n                    var thealias = vm2.mySlots[itsid].title;\n                    var theslot = StorageFactory.getGetter(thealias)();\n                    console.log(\"removing slots:\",theslot, \" alias \" ,thealias);\n                    StorageFactory.getSetter(thealias)();\n                    StorageFactory.getSetter(theslot)();\n                    var myslots = StorageFactory.getGetter(\"myslots\")();\n                    delete myslots[itsid];\n                    StorageFactory.getSetter(\"myslots\")(myslots);\n                }\n\n\n                function deleteContainingFiles(object)\n                {\n                    var results = [];\n                    console.log(\"children:\", object.$childNodesScope.$modelValue);\n                    var array = object.$childNodesScope.$modelValue;\n\n                    findResults(array);\n\n                    function findResults(sublist)\n                    {\n                        for(var i=0 ; i< sublist.length; i++)\n                        {\n                            if(!(sublist[i].isDirectory))\n                            {\n                                results.push(sublist[i].id);\n                            }\n                            else\n                            {\n                                if(sublist[i].nodes.length > 0)\n                                {\n                                    findResults(sublist[i].nodes);   \n                                }\n                            }\n                        }\n                    }\n                     return results;  \n                }\n\n                function getRoot(obj)\n                {\n                    var parking = obj;\n                    while(parking.$parentNodeScope !== null)\n                    {\n                        parking = parking.$parentNodeScope ;\n                    }\n                    console.log(\"root:\", parking.$parentNodesScope.$modelValue);\n                    return parking;\n                }\n\n                function traverseArray(sublist, ok)\n                {\n                    \n                    if(ok){return ok;}\n                    for(var i = 0 ; i<sublist.length; i++)\n                    {\n                        console.log(sublist[i].title,sublist[i].id);\n                        if(!(sublist[i].isDirectory) && sublist[i] !== object.$modelValue) \n                        {\n                            console.log(\"match with\", sublist[i].title);\n                            ok = true;\n                            break;\n                        }\n                        else\n                        {\n                            if(sublist[i].nodes.length > 0)\n                            {\n                                ok = traverseArray(sublist[i].nodes, ok);\n                            }\n                        }\n                    }\n                    return ok;\n                } \n\n                function lookForDirectory(sublist, callerid)\n                {\n                    for (var i = 0 ; i < sublist.length ; i ++)\n                    {\n                        if(sublist[i].isDirectory && sublist[i].id !== callerid)\n                        {\n                            console.log(\"found directory\" , sublist[i].title);\n                            return true;\n                        }\n                    }\n                }                 \n\n                \n            }\n\n            function toggle(item)\n            {\n               item.toggle();\n            }\n\n            function newSubitem(item)\n            {\n                //console.log(\"parent:\",item.$parent.$parent.$parent.$parent.$modelValue.title);\n                var theitem = item.$modelValue;\n                console.log(theitem);\n\n                if(theitem.isDirectory)\n                {\n                    theitem.nodes.push({\n                    id: Math.floor(Math.random()*10000) ,\n                    title: theitem.title ,\n                    isDirectory : true,\n                    nodes: []\n                    });\n                }\n                else\n                {\n                    var theid = Math.floor(Math.random()*10000);\n                    var thetitle = theitem.title + '-' + createRandomSuffix();\n                    var newobject = {\n                            id: theid ,\n                            title: thetitle,\n                            isDirectory : false,\n                            isLocked : false,\n                            nodes: []\n                            };\n\n\n                    if(item.$parentNodeScope !== null)\n                    {\n                        item.$parentNodeScope.$modelValue.nodes.push(newobject);\n                    }\n                    else\n                    {\n                        vm2.list.push(newobject);\n                    }\n                    // console.log(\"item:\", item);\n                    // console.log(\"theid \", theid);\n                    StorageFactory.getNewSlotname(thetitle, theid);\n                    vm2.mySlots[theid] = {\"title\" : thetitle,\"isLocked\": false};\n                    setSelectedSlot(newobject);\n                }\n            }\n\n\n            function createRandomSuffix()\n            {\n                var suffixes = \"abcdefghijklmnopqrstuvwxyzABCDEFGHILJKLMNOPRSTUVWXYZ\";\n                var result = \"\";\n                for(var i=0 ; i<3; i++)\n                {\n                    var randomdigit = Math.floor(Math.random()*suffixes.length);\n                    var letter = suffixes.substring(randomdigit,randomdigit + 1);\n                    result += letter;\n                }\n                return result;\n            }\n\n\n        })\n\n        //controls the modal that appears when you're loading a zip\n        .controller('LoadZipController', function($uibModalInstance, ZipService, items)\n            {\n                var vm3 = this;\n                vm3.closeModal = closeModal;\n                vm3.getZipOverHttp = getZipOverHttp;\n\n                function getZipOverHttp()\n                {\n                    console.log(\"getzip over http...\");\n                    ZipService.getZip().then(function success(data)\n                    {\n                        console.log(\"data back\", data);\n                        $uibModalInstance.close({returntype:\"viahttp\",data:data});\n                        \n                    }, function fail(err)\n                    {\n                        console.log(\"failure getting zip via http: \", err);\n                    });\n                }                \n\n                \n\n                function closeModal()\n                {\n                    $uibModalInstance.close(\"dialog cancelled.\");\n                }\n            })\n\n\n\n        //Returns the part after the last slash of a file.\n        .filter('cropFilter', function()\n        {\n            return function(item)\n            {\n                if(item === undefined) return \"\";\n                var helper = item.substring(item.lastIndexOf('/') + 1 ,item.length);\n                if(helper.length > 0)\n                {\n                    return helper;\n                }\n                else\n                {\n                    return item;\n                }\n            };\n        });\n\n})();\n\n(function ()\n{\n    \n/*\n    Defines an xmlTag object that will be used as the main data carrier in the editor;\n*/\nangular.module('confab')\n\n    .factory('xmlTag', function() \n        {\n        /*\n        tagTypes are \"STARTTAG\", \"COMBITAG\", and \"ENDTAG\"\n        */\n\n        var staticPipenames = [\"FixedQuerySender\", \"XmlWellFormedChecker\",\"XmlValidator\",\"XmlSwitch\",\"XmlIf\",\"WsdlXmlValidator\",\"RemoveFromSession\",\"PutSystemDateInSession\",\"PutInSession\",\"MailSender\",\"LogSender\",\"Json2XmlValidator\",\"JmsCommunicator\",\"PutParametersInSession\",\"IsolatedServiceExecutor\",\"IsolatedServiceCaller\",\"IfMultipart\",\"GetFromSession\",\"FixedResultSender\",\"FixedResult\",\"FilenameSwitch\",\"XmlParamSwitch\",\"EchoSender\"];\n\n\n        function xmlTag(elementname, proparray) \n        {\n            this.tagType = \"STARTTAG\";\n            this.elementName = elementname;\n            tagProperties = {};\n            proparray.forEach(function(prop)\n            {\n                tagProperties[prop.getAttributeName()] = prop.getAttributeValues();\n            }); \n            this.tagProperties = tagProperties; \n        }\n        //native functions of the xmlTag that can access the instance properties\n        xmlTag.prototype = \n        {\n            getTagType : function()\n            {\n                return this.tagType;\n            },\n            setTagType : function(astring)\n            {\n                switch (astring)\n                {\n                    case \"STARTTAG\":{this.tagType = \"STARTTAG\"; break;}\n                    case \"COMBITAG\":{this.tagType = \"COMBITAG\";break;}\n                    case \"ENDTAG\":{this.tagType = \"ENDTAG\";break;}\n                    default :{console.log(\"tagType is set to default..\",astring,\" is unknown type.\");\n                                this.tagType = \"STARTTAG\";}\n                }\n            },\n            toCompleteTag : function()\n            {\n                var returnstring = \"\";  \n                var itsproperties = \"\"; \n                this.convertToPipe();\n                \n                angular.forEach(this.tagProperties, function(value, key)\n                {\n                    if (value == \"\")\n                    {\n                        itsproperties += \" \" + key + \"=\\\"\\\" \" + \" \";\n                    }\n                    else\n                    {\n                        itsproperties += \" \" + key + \"=\\\"\" + value + '\\\"';   \n                    }\n\n                });\n             returnstring =                     \"<\" + \n                                        this.elementName + \n                                        itsproperties + \n                                        \"></\" +\n                                        this.elementName + \n                                        \">\" ;\n                                           \n\n             return returnstring;                           \n\n\n            },\n            //converts its contents to a readable xml-tag, dependent on its type\n            toObject : function()\n            {\n                var theobject = {} ;\n                theobject[this.elementName] = this.tagProperties;\n                console.log(\"myobj\", theobject);\n                return theobject;\n            },\n            setProperty :function (key, value)\n            {\n                this.tagProperties[key] = value;\n            },\n            getPropertyValue :function (key)\n            {\n                return this.tagProperties[key];\n            },\n            //necessary while waiting for new IAF release; for now these elements have\n            //a default classname attached.\n            convertToPipe: function()\n            {\n                if (this.elementName.search( /^.*Pipe$/ ) !== -1)\n                {\n                    this.elementName = \"pipe\"; \n                }\n\n                if(staticPipenames.includes(this.elementName))\n                {\n                    this.elementName = \"pipe\";    \n                }\n\n                var regex = \"/^.*Pipe$/\";\n                console.log(\"elementname\",this.elementName, this.elementName.search(regex));\n\n            }\n\n        };\n       /*static functions that have no access to this:\n        xmlTag.computeTabdistance = function(tag)\n        {\n            return tabdistance\n        }\n       */\n        return (xmlTag);\n        })\n\n    .factory('attributeObject', function()\n    {\n        function attributeObject(attributename, values, hasDefault)\n        {\n            this.name = attributename;\n            \n            if(values !== undefined)\n            {\n                this.values = values;\n            }\n            else\n            {\n                this.values = [];\n            }\n            if (hasDefault !== undefined)\n            {\n                this.hasDefault = hasDefault;\n            }\n            else \n            {\n                this.hasDefault = false;\n            }\n        }\n\n        attributeObject.prototype = \n        {\n            setAttributeValue : function(value)\n            {\n                if (this.hasDefault)\n                {\n                    this.values.unShift(value);\n                }\n                else \n                {\n                    this.values.push(value);\n                }\n            },\n\n            //insert a whole array\n            insertValues : function(array)\n            {\n               this.values = array; \n            },\n\n            getAttributeName : function()\n            {\n                return this.name;\n            },\n\n            //returns an array of possible values \n            getAttributeValues : function()\n            {\n                return this.values;\n            },\n            \n            setDefaultValue : function(bool)\n            {\n                this.hasDefault = bool ;\n            },\n\n            toString : function()\n            {\n                return this.name + 'Allowed values:' + this.values.join();\n            }\n        };\n\n\n        return(attributeObject);\n\n        \n\n\n\n\n\n    });\n\n})();"],"sourceRoot":"/source/"}